/*
	Redactor v9.0.2
	Updated: Jun 25, 2013

	http://imperavi.com/redactor/

	Copyright (c) 2009-2013, Imperavi LLC.
	License: http://imperavi.com/redactor/license/

	Usage: $('#content').redactor();
*/
!function(e){function t(e,i){return new t.prototype.init(e,i)}var i=0,n=!1,s=function(e){return this[0]=e.startOffset,this[1]=e.endOffset,this.range=e,this};s.prototype.equals=function(){return this[0]===this[1]},e.fn.redactor=function(i){var n=[],s=Array.prototype.slice.call(arguments,1);return"string"==typeof i?this.each(function(){var t=e.data(this,"redactor");if("undefined"==typeof t||!e.isFunction(t[i]))return e.error('No such method "'+i+'" for Redactor');var a=t[i].apply(t,s);void 0!==a&&a!==t&&n.push(a)}):this.each(function(){e.data(this,"redactor")||e.data(this,"redactor",t(this,i))}),0===n.length?this:1===n.length?n[0]:n},e.Redactor=t,e.Redactor.VERSION="9.0.2",e.Redactor.opts={initCallback:!1,changeCallback:!1,focusCallback:!1,blurCallback:!1,keydownCallback:!1,keyupCallback:!1,execCommandCallback:!1,pasteBeforeCallback:!1,pasteAfterCallback:!1,autosaveCallback:!1,imageUploadCallback:!1,imageUploadErrorCallback:!1,imageDeleteCallback:!1,fileUploadCallback:!1,fileUploadErrorCallback:!1,rangy:!1,iframe:!1,fullpage:!1,css:!1,lang:"en",direction:"ltr",placeholder:!1,wym:!1,mobile:!0,cleanup:!0,visual:!0,focus:!1,tabindex:!1,autoresize:!0,minHeight:!1,shortcuts:!0,autosave:!1,autosaveInterval:60,plugins:!1,linkAnchor:!1,linkEmail:!1,linkProtocol:"http://",imageGetJson:!1,imageUpload:!1,fileUpload:!1,s3:!1,uploadFields:!1,observeImages:!0,modalOverlay:!0,tabFocus:!0,air:!1,airButtons:["formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","fontcolor","backcolor"],toolbar:!0,toolbarFixed:!1,toolbarFixedTopOffset:0,toolbarFixedBox:!1,toolbarExternal:!1,buttonSource:!0,buttonSeparator:'<li class="redactor_separator"></li>',buttonsCustom:{},buttonsAdd:[],buttons:["html","|","formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","image","video","file","table","link","|","fontcolor","backcolor","|","alignment","|","horizontalrule"],colors:["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"],activeButtons:["deleted","italic","bold","underline","unorderedlist","orderedlist","alignleft","aligncenter","alignright","justify","table"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted",ul:"unorderedlist",ol:"orderedlist",u:"underline",tr:"table",td:"table",table:"table"},activeButtonsAdd:!1,formattingTags:["p","blockquote","pre","h1","h2","h3","h4"],linebreaks:!1,paragraphy:!0,convertDivs:!0,convertLinks:!0,formattingPre:!1,phpTags:!1,allowedTags:!1,deniedTags:["html","head","link","body","meta","script","style","applet"],boldTag:"strong",italicTag:"em",buffer:[],rebuffer:[],textareamode:!1,emptyHtml:"<p>&#x200b;</p>",invisibleSpace:"&#x200b;",rBlockTest:/^(P|H[1-6]|LI|ADDRESS|SECTION|HEADER|FOOTER|ASIDE|ARTICLE)$/i,alignmentTags:["H1","H2","H3","H4","H5","H6","P","TD","DIV","BLOCKQUOTE"],ownLine:["area","body","head","hr","i?frame","link","meta","noscript","style","script","table","tbody","thead","tfoot"],contOwnLine:["li","dt","dt","h[1-6]","option","script"],newLevel:["blockquote","div","dl","fieldset","form","frameset","map","ol","p","pre","select","td","th","tr","ul"],blockLevelElements:["P","H1","H2","H3","H4","H5","H6","DD","DL","DT","DIV","LI","BLOCKQUOTE","OUTPUT","FIGCAPTION","PRE","ADDRESS","SECTION","HEADER","FOOTER","ASIDE","ARTICLE"],langs:{en:{html:"HTML",video:"Insert Video",image:"Insert Image",table:"Table",link:"Link",link_insert:"Insert link",link_edit:"Edit link",unlink:"Unlink",formatting:"Formatting",paragraph:"Normal text",quote:"Quote",code:"Code",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",bold:"Bold",italic:"Italic",fontcolor:"Font Color",backcolor:"Back Color",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",cancel:"Cancel",insert:"Insert",save:"Save",_delete:"Delete",insert_table:"Insert Table",insert_row_above:"Add Row Above",insert_row_below:"Add Row Below",insert_column_left:"Add Column Left",insert_column_right:"Add Column Right",delete_column:"Delete Column",delete_row:"Delete Row",delete_table:"Delete Table",rows:"Rows",columns:"Columns",add_head:"Add Head",delete_head:"Delete Head",title:"Title",image_position:"Position",none:"None",left:"Left",right:"Right",image_web_link:"Image Web Link",text:"Text",mailto:"Email",web:"URL",video_html_code:"Video Embed Code",file:"Insert File",upload:"Upload",download:"Download",choose:"Choose",or_choose:"Or choose",drop_file_here:"Drop file here",align_left:"Align text to the left",align_center:"Center text",align_right:"Align text to the right",align_justify:"Justify text",horizontalrule:"Insert Horizontal Rule",deleted:"Deleted",anchor:"Anchor",link_new_tab:"Open link in new tab",underline:"Underline",alignment:"Alignment",filename:"Name (optional)"}}},t.fn=e.Redactor.prototype={keyCode:{BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,ESC:27,TAB:9,CTRL:17,META:91,LEFT:37,LEFT_WIN:91},init:function(t,n){if(this.$element=this.$source=e(t),this.uuid=i++,this.opts=e.extend({},e.Redactor.opts,this.$element.data(),n),this.start=!0,this.dropdowns=[],this.sourceHeight=this.$source.css("height"),this.sourceWidth=this.$source.css("width"),this.opts.fullpage&&(this.opts.iframe=!0),this.opts.linebreaks&&(this.opts.paragraphy=!1),this.opts.paragraphy&&(this.opts.linebreaks=!1),this.opts.toolbarFixedBox&&(this.opts.toolbarFixed=!0),this.document=document,this.window=window,this.savedSel=!1,this.cleanlineBefore=new RegExp("^<(/?"+this.opts.ownLine.join("|/?")+"|"+this.opts.contOwnLine.join("|")+")[ >]"),this.cleanlineAfter=new RegExp("^<(br|/?"+this.opts.ownLine.join("|/?")+"|/"+this.opts.contOwnLine.join("|/")+")[ >]"),this.cleannewLevel=new RegExp("^</?("+this.opts.newLevel.join("|")+")[ >]"),this.rTestBlock=new RegExp("^("+this.opts.blockLevelElements.join("|")+")$","i"),this.opts.linebreaks===!1&&(this.opts.allowedTags!==!1&&"-1"===e.inArray("p",this.opts.allowedTags)&&this.opts.allowedTags.push("p"),this.opts.deniedTags!==!1)){var s=e.inArray("p",this.opts.deniedTags);"-1"!==s&&this.opts.deniedTags.splice(s,s)}(this.browser("msie")||this.browser("opera"))&&(this.opts.buttons=this.removeFromArrayByValue(this.opts.buttons,"horizontalrule")),this.opts.curLang=this.opts.langs[this.opts.lang],this.buildStart()},initToolbar:function(e){return{html:{title:e.html,func:"toggle"},formatting:{title:e.formatting,func:"show",dropdown:{p:{title:e.paragraph,func:"formatBlocks"},blockquote:{title:e.quote,func:"formatQuote",className:"redactor_format_blockquote"},pre:{title:e.code,func:"formatBlocks",className:"redactor_format_pre"},h1:{title:e.header1,func:"formatBlocks",className:"redactor_format_h1"},h2:{title:e.header2,func:"formatBlocks",className:"redactor_format_h2"},h3:{title:e.header3,func:"formatBlocks",className:"redactor_format_h3"},h4:{title:e.header4,func:"formatBlocks",className:"redactor_format_h4"}}},bold:{title:e.bold,exec:"bold"},italic:{title:e.italic,exec:"italic"},deleted:{title:e.deleted,exec:"strikethrough"},underline:{title:e.underline,exec:"underline"},unorderedlist:{title:"&bull; "+e.unorderedlist,exec:"insertunorderedlist"},orderedlist:{title:"1. "+e.orderedlist,exec:"insertorderedlist"},outdent:{title:"< "+e.outdent,func:"indentingOutdent"},indent:{title:"> "+e.indent,func:"indentingIndent"},image:{title:e.image,func:"imageShow"},video:{title:e.video,func:"videoShow"},file:{title:e.file,func:"fileShow"},table:{title:e.table,func:"show",dropdown:{insert_table:{title:e.insert_table,func:"tableShow"},separator_drop1:{name:"separator"},insert_row_above:{title:e.insert_row_above,func:"tableAddRowAbove"},insert_row_below:{title:e.insert_row_below,func:"tableAddRowBelow"},insert_column_left:{title:e.insert_column_left,func:"tableAddColumnLeft"},insert_column_right:{title:e.insert_column_right,func:"tableAddColumnRight"},separator_drop2:{name:"separator"},add_head:{title:e.add_head,func:"tableAddHead"},delete_head:{title:e.delete_head,func:"tableDeleteHead"},separator_drop3:{name:"separator"},delete_column:{title:e.delete_column,func:"tableDeleteColumn"},delete_row:{title:e.delete_row,func:"tableDeleteRow"},delete_table:{title:e.delete_table,func:"tableDeleteTable"}}},link:{title:e.link,func:"show",dropdown:{link:{title:e.link_insert,func:"linkShow"},unlink:{title:e.unlink,exec:"unlink"}}},fontcolor:{title:e.fontcolor,func:"show"},backcolor:{title:e.backcolor,func:"show"},alignment:{title:e.alignment,func:"show",dropdown:{alignleft:{title:e.align_left,func:"alignmentLeft"},aligncenter:{title:e.align_center,func:"alignmentCenter"},alignright:{title:e.align_right,func:"alignmentRight"},justify:{title:e.align_justify,func:"alignmentJustify"}}},alignleft:{title:e.align_left,func:"alignmentLeft"},aligncenter:{title:e.align_center,func:"alignmentCenter"},alignright:{title:e.align_right,func:"alignmentRight"},justify:{title:e.align_justify,func:"alignmentJustify"},horizontalrule:{exec:"inserthorizontalrule",title:e.horizontalrule}}},callback:function(t,i,n){var s=this.opts[t+"Callback"];return e.isFunction(s)?i===!1?s.call(this,n):s.call(this,i,n):n},destroy:function(){clearInterval(this.autosaveInterval),e(window).off(".redactor"),this.$element.off(".redactor").removeData("redactor");var t=this.get();if(this.opts.textareamode)this.$box.after(this.$source),this.$box.remove(),this.$source.val(t).show();else{var i=this.$editor;this.opts.iframe&&(i=this.$element),this.$box.after(i),this.$box.remove(),i.removeClass("redactor_editor").removeClass("redactor_editor_wym").removeAttr("contenteditable").html(t).show()}},getObject:function(){return e.extend({},this)},getEditor:function(){return this.$editor},getBox:function(){return this.$box},getIframe:function(){return this.opts.iframe?this.$frame:!1},getToolbar:function(){return this.$toolbar},get:function(){return this.$source.val()},getCodeIframe:function(){this.$editor.removeAttr("contenteditable").removeAttr("dir");var e=this.outerHtml(this.$frame.contents().children());return this.$editor.attr({contenteditable:!0,dir:this.opts.direction}),e},set:function(e,t){e=e.toString(),this.opts.fullpage?this.setCodeIframe(e):this.setEditor(e,t)},setEditor:function(e,t){t!==!1&&(e=this.cleanSavePreCode(e),e=this.cleanStripTags(e),e=this.cleanConvertProtected(e),e=this.cleanConvertInlineTags(e),e=this.opts.linebreaks===!1?this.cleanConverters(e):e.replace(/<p(.*?)>([\w\W]*?)<\/p>/gi,"$2<br>")),e=this.cleanEmpty(e),this.$editor.html(e),this.sync()},setCodeIframe:function(e){var t=this.iframePage();this.$frame[0].src="about:blank",e=this.cleanConvertProtected(e),e=this.cleanConvertInlineTags(e),e=this.cleanRemoveSpaces(e),t.open(),t.write(e),t.close(),this.opts.fullpage&&(this.$editor=this.$frame.contents().find("body").attr({contenteditable:!0,dir:this.opts.direction})),this.sync()},setFullpageOnInit:function(e){e=this.cleanSavePreCode(e,!0),e=this.cleanConverters(e),e=this.cleanEmpty(e),this.$editor.html(e),this.sync()},sync:function(){var t="";this.cleanUnverified(),t=this.opts.fullpage?this.getCodeIframe():this.$editor.html(),t=this.syncClean(t),t=this.cleanRemoveSpaces(t),t=this.cleanRemoveEmptyTags(t),t=t.replace(/<\/li><(ul|ol)>([\w\W]*?)<\/(ul|ol)>/gi,"<$1>$2</$1></li>"),"<br>"===e.trim(t)&&(t=""),""!==t&&(t=this.cleanHtml(t)),t=this.callback("syncBefore",!1,t),this.$source.val(t),"undefined"!=typeof htmlEncode&&e("#"+this.$element[0].id+"_code").html(htmlEncode(t)),this.callback("syncAfter",!1,t),this.start===!1&&this.callback("change",!1,t)},syncClean:function(t){return this.opts.fullpage||(t=this.cleanStripTags(t)),t=e.trim(t),t=this.placeholderRemoveFromCode(t),t=t.replace(/&#x200b;/gi,""),t=t.replace(/&#8203;/gi,""),t=t.replace(/&nbsp;/gi," "),t=t.replace("<!--?php","<?php"),t=t.replace("?-->","?>"),t=t.replace(/<span(.*?)data-redactor="verified"(.*?)>([\w\W]*?)<\/span>/gi,'<font$1data-redactor="verified"$2>$3</font>'),t=t.replace(/<span(.*?)>([\w\W]*?)<\/span>/gi,"$2"),t=t.replace(/<font(.*?)data-redactor="verified"(.*?)>([\w\W]*?)<\/font>/gi,"<span$1$2>$3</span>"),t=t.replace(/<br\s?\/?>\n?<\/(.*?)>/gi,"</$1>"),t=t.replace(/<span(.*?)data-redactor-inlineMethods=""(.*?)>([\w\W]*?)<\/span>/gi,"<span$1$2>$3</span>"),t=t.replace(/<span\s*?>([\w\W]*?)<\/span>/gi,"$1"),t=t.replace(/<span\s*?id="selection-marker(.*?)"(.*?)>([\w\W]*?)<\/span>/gi,""),t=this.cleanReConvertProtected(t)},buildStart:function(){this.content="",this.$box=e('<div class="redactor_box" />'),"TEXTAREA"===this.$source[0].tagName&&(this.opts.textareamode=!0),this.opts.mobile===!1&&this.isMobile()?this.buildMobile():(this.buildContent(),this.opts.iframe?(this.opts.autoresize=!1,this.iframeStart()):this.opts.textareamode?this.buildFromTextarea():this.buildFromElement(),this.opts.iframe||(this.buildOptions(),this.buildAfter()))},buildMobile:function(){this.opts.textareamode||(this.$editor=this.$source,this.$editor.hide(),this.$source=this.buildCodearea(this.$editor),this.$source.val(this.content)),this.$box.insertAfter(this.$source).append(this.$source)},buildContent:function(){this.content=this.opts.textareamode?e.trim(this.$source.val()):e.trim(this.$source.html())},buildFromTextarea:function(){this.$editor=e("<div />"),this.$box.insertAfter(this.$source).append(this.$editor).append(this.$source),this.buildAddClasses(this.$editor),this.buildEnable()},buildFromElement:function(){this.$editor=this.$source,this.$source=this.buildCodearea(this.$editor),this.$box.insertAfter(this.$editor).append(this.$editor).append(this.$source),this.buildEnable()},buildCodearea:function(t){return e("<textarea />").attr("name",t.attr("id")).css("height",this.sourceHeight)},buildAddClasses:function(t){e.each(this.$source.get(0).className.split(/\s+/),function(e,i){t.addClass("redactor_"+i)})},buildEnable:function(){this.$editor.addClass("redactor_editor").attr({contenteditable:!0,dir:this.opts.direction}),this.$source.attr("dir",this.opts.direction).hide(),this.set(this.content)},buildOptions:function(){var e=this.$editor;this.opts.iframe&&(e=this.$frame),this.opts.tabindex&&e.attr("tabindex",this.opts.tabindex),this.opts.minHeight&&e.css("min-height",this.opts.minHeight+"px"),this.opts.wym&&this.$editor.addClass("redactor_editor_wym"),this.opts.autoresize||e.css("height",this.sourceHeight)},buildAfter:function(){if(this.start=!1,this.opts.toolbar&&(this.opts.toolbar=this.initToolbar(this.opts.curLang),this.toolbarBuild()),this.modalTemplatesInit(),this.buildPlugins(),this.buildBindKeyboard(),this.opts.autosave&&this.autosave(),setTimeout(e.proxy(this.observeStart,this),4),this.browser("mozilla"))try{this.document.execCommand("enableObjectResizing",!1,!1),this.document.execCommand("enableInlineTableEditing",!1,!1)}catch(t){}this.opts.focus&&setTimeout(e.proxy(this.focus,this),100),this.opts.visual||setTimeout(e.proxy(function(){this.opts.visual=!0,this.toggle(!1)},this),200),this.callback("init")},buildBindKeyboard:function(){var t=!1;if(this.browser("webkit")&&-1===navigator.userAgent.indexOf("Chrome")){var i=this.browser("version").split(".");i[0]<536&&(t=!0)}this.$editor.on("paste.redactor",e.proxy(function(){if(t)return!0;if(this.browser("opera"))return!0;if(this.isMobile())return!1;if(!this.opts.cleanup)return!1;n=!0,this.selectionSave(),this.selectall||(this.opts.autoresize===!0?(this.$editor.height(this.$editor.height()),this.saveScroll=this.document.body.scrollTop):this.saveScroll=this.$editor.scrollTop());var i=this.extractContent();setTimeout(e.proxy(function(){var e=this.extractContent();this.$editor.append(i),this.selectionRestore();var t=this.getFragmentHtml(e);this.pasteClean(t),this.opts.autoresize===!0&&this.$editor.css("height","auto")},this),1)},this)),this.$editor.on("keydown.redactor",e.proxy(function(t){if(n)return!1;var i=t.which,s=t.ctrlKey||t.metaKey,a=this.getParent(),o=this.getCurrent(),r=this.getBlock(),l=!1;if(this.callback("keydown",t),(a&&"PRE"===e(a).get(0).tagName||o&&"PRE"===e(o).get(0).tagName)&&(l=!0,i===this.keyCode.DOWN&&this.insertAfterLastElement(r)),i===this.keyCode.DOWN&&(a&&"BLOCKQUOTE"===e(a).get(0).tagName&&this.insertAfterLastElement(a),o&&"BLOCKQUOTE"===e(o).get(0).tagName&&this.insertAfterLastElement(o)),s&&!t.shiftKey&&this.shortcuts(t,i),s&&90===i&&!t.shiftKey&&!t.altKey)return t.preventDefault(),this.opts.buffer.length?this.bufferUndo():this.document.execCommand("undo",!1,!1),void 0;if(s&&90===i&&t.shiftKey&&!t.altKey)return t.preventDefault(),0!=this.opts.rebuffer.length?this.bufferRedo():this.document.execCommand("redo",!1,!1),void 0;if(s&&65===i?this.selectall=!0:i==this.keyCode.LEFT_WIN||s||(this.selectall=!1),i!=this.keyCode.ENTER||t.shiftKey||t.ctrlKey||t.metaKey)i===this.keyCode.ENTER&&(t.ctrlKey||t.shiftKey)&&(this.bufferSet(),t.preventDefault(),this.insertLineBreak());else{if(1==a.nodeType&&("TD"==a.tagName||"TH"==a.tagName))return this.bufferSet(),this.insertNode(document.createElement("br")),t.preventDefault(),!1;if(l===!0){this.bufferSet(),t.preventDefault();var c=e(o).parent().text();return this.insertNode(document.createTextNode("\n")),-1==c.search(/\s$/)&&this.insertNode(document.createTextNode("\n")),this.sync(),!1}if(!this.opts.linebreaks)if(r&&this.opts.rBlockTest.test(r.tagName))this.bufferSet(),setTimeout(e.proxy(function(){var t=this.getBlock();if("DIV"===t.tagName&&!e(t).hasClass("redactor_editor")){var i=e("<p>"+this.opts.invisibleSpace+"</p>");e(t).replaceWith(i),this.selectionStart(i)}},this),1);else if(r===!1){this.bufferSet();var d=e("<p>"+this.opts.invisibleSpace+"</p>");return this.insertNode(d[0]),this.selectionStart(d),!1}if(this.opts.linebreaks){if(!r||!this.opts.rBlockTest.test(r.tagName))return this.bufferSet(),this.insertLineBreak(),t.preventDefault(),void 0;this.bufferSet(),setTimeout(e.proxy(function(){var t=this.getBlock();"DIV"!==t.tagName&&"P"!==t.tagName||e(t).hasClass("redactor_editor")||this.replaceLineBreak(t)},this),1)}if("BLOCKQUOTE"==r.tagName||"FIGCAPTION"==r.tagName)return this.bufferSet(),this.insertLineBreak(),t.preventDefault(),void 0}if(i===this.keyCode.TAB&&this.opts.shortcuts)return this.opts.tabFocus?this.isEmpty(this.get())?!0:(t.preventDefault(),l!==!0||t.shiftKey?(t.shiftKey?this.indentingOutdent():this.indentingIndent(),!1):(this.bufferSet(),this.insertNode(document.createTextNode("	")),this.sync(),!1)):!0;if(i===this.keyCode.BACKSPACE&&"undefined"!=typeof o.nodeValue&&null!==o.nodeValue){var h=e.trim(o.nodeValue.replace(/[^\u0000-~]/g,""));o.remove&&3===o.nodeType&&8203==o.nodeValue.charCodeAt(0)&&""==h&&o.remove()}},this)),this.$editor.on("keyup.redactor",e.proxy(function(t){if(n)return!1;var i=t.which,s=this.getParent(),a=this.getCurrent();if(!this.opts.linebreaks&&3==a.nodeType&&(0==s||"BODY"==s.tagName)){var o=e("<p>").append(e(a).clone());e(a).replaceWith(o);var r=e(o).next();"BR"==r[0].tagName&&r.remove(),this.selectionEnd(o)}return this.opts.convertLinks&&i===this.keyCode.ENTER&&this.formatLinkify(this.opts.linkProtocol),this.opts.linebreaks!==!1||i!==this.keyCode.DELETE&&i!==this.keyCode.BACKSPACE?(this.callback("keyup",t),this.sync(),void 0):this.formatEmpty(t)},this)),e.isFunction(this.opts.focusCallback)&&this.$editor.on("focus.redactor",e.proxy(this.opts.focusCallback,this)),e.isFunction(this.opts.blurCallback)&&this.$editor.on("blur.redactor",e.proxy(this.opts.blurCallback,this))},buildPlugins:function(){this.opts.plugins&&e.each(this.opts.plugins,e.proxy(function(t,i){RedactorPlugins[i]&&(e.extend(this,RedactorPlugins[i]),e.isFunction(RedactorPlugins[i].init)&&this.init())},this))},iframeStart:function(){this.iframeCreate(),this.opts.textareamode?this.iframeAppend(this.$source):(this.$sourceOld=this.$source.hide(),this.$source=this.buildCodearea(this.$sourceOld),this.iframeAppend(this.$sourceOld))},iframeAppend:function(e){this.$source.attr("dir",this.opts.direction).hide(),this.$box.insertAfter(e).append(this.$frame).append(this.$source)},iframeCreate:function(){this.$frame=e('<iframe style="width: 100%;" frameborder="0" />').one("load",e.proxy(function(){if(this.opts.fullpage){this.iframePage(),""===this.content&&(this.content=this.opts.invisibleSpace),this.$frame.contents()[0].write(this.content),this.$frame.contents()[0].close();var t=setInterval(e.proxy(function(){this.$frame.contents().find("body").html()&&(clearInterval(t),this.iframeLoad())},this),0)}else this.iframeLoad()},this))},iframeDoc:function(){return this.$frame[0].contentWindow.document},iframePage:function(){var e=this.iframeDoc();return e.documentElement&&e.removeChild(e.documentElement),e},iframeAddCss:function(t){t=t||this.opts.css,this.isString(t)&&this.$frame.contents().find("head").append('<link rel="stylesheet" href="'+t+'" />'),e.isArray(t)&&e.each(t,e.proxy(function(e,t){this.iframeAddCss(t)},this))},iframeLoad:function(){this.$editor=this.$frame.contents().find("body").attr({contenteditable:!0,dir:this.opts.direction}),this.$editor[0]&&(this.document=this.$editor[0].ownerDocument,this.window=this.document.defaultView||window),this.iframeAddCss(),this.opts.fullpage?this.setFullpageOnInit(this.$editor.html()):this.set(this.content),this.buildOptions(),this.buildAfter()},placeholderStart:function(t){return this.isEmpty(t)&&(this.$element.attr("placeholder")&&(this.opts.placeholder=this.$element.attr("placeholder")),""===this.opts.placeholder&&(this.opts.placeholder=!1),this.opts.placeholder!==!1)?(this.opts.focus=!1,this.$editor.one("focus.redactor_placeholder",e.proxy(this.placeholderFocus,this)),e('<span class="redactor_placeholder" data-redactor="verified">').attr("contenteditable",!1).text(this.opts.placeholder)):!1},placeholderFocus:function(){this.$editor.find("span.redactor_placeholder").remove();var e="";this.opts.linebreaks===!1&&(e=this.opts.emptyHtml),this.$editor.off("focus.redactor_placeholder"),this.$editor.html(e),this.opts.linebreaks===!1&&this.selectionStart(this.$editor.children()[0]),this.sync()},placeholderRemove:function(){this.opts.placeholder=!1,this.$editor.find("span.redactor_placeholder").remove(),this.$editor.off("focus.redactor_placeholder")},placeholderRemoveFromCode:function(e){return e.replace(/<span class="redactor_placeholder"(.*?)>(.*?)<\/span>/i,"")},shortcuts:function(e,t){this.opts.shortcuts&&(e.altKey?48===t?this.shortcutsLoadFormat(e,"p"):49===t?this.shortcutsLoadFormat(e,"h1"):50===t?this.shortcutsLoadFormat(e,"h2"):51===t?this.shortcutsLoadFormat(e,"h3"):52===t?this.shortcutsLoadFormat(e,"h4"):53===t?this.shortcutsLoadFormat(e,"h5"):54===t&&this.shortcutsLoadFormat(e,"h6"):77===t?this.shortcutsLoad(e,"removeFormat"):66===t?this.shortcutsLoad(e,"bold"):73===t?this.shortcutsLoad(e,"italic"):74===t?this.shortcutsLoad(e,"insertunorderedlist"):75===t?this.shortcutsLoad(e,"insertorderedlist"):72===t?this.shortcutsLoad(e,"superscript"):76===t&&this.shortcutsLoad(e,"subscript"))},shortcutsLoad:function(e,t){e.preventDefault(),this.execCommand(t,!1)},shortcutsLoadFormat:function(e,t){e.preventDefault(),this.formatBlocks(t)},focus:function(){this.browser("opera")?this.$editor.focus():this.window.setTimeout(e.proxy(this.focusSet,this,!0),1)},focusEnd:function(){this.focusSet()},focusSet:function(e){this.$editor.focus();var t=this.getRange();t.selectNodeContents(this.$editor[0]),t.collapse(e||!1);var i=this.getSelection();i.removeAllRanges(),i.addRange(t)},toggle:function(t){var i;if(this.opts.visual){t!==!1&&this.selectionSave();var n=null;this.opts.iframe?(n=this.$frame.height(),this.opts.fullpage&&this.$editor.removeAttr("contenteditable"),this.$frame.hide()):(n=this.$editor.innerHeight(),this.$editor.hide()),i=this.$source.val(),this.modified=i,this.$source.height(n).show().focus(),this.$source.on("keydown.redactor-textarea",function(t){if(9===t.keyCode){var i=e(this),n=i.get(0).selectionStart;return i.val(i.val().substring(0,n)+"	"+i.val().substring(i.get(0).selectionEnd)),i.get(0).selectionStart=i.get(0).selectionEnd=n+1,!1}}),this.buttonInactiveVisual(),this.buttonActive("html"),this.opts.visual=!1}else i=this.$source.hide().val(),"undefined"!=typeof this.modified&&(this.modified=this.cleanRemoveSpaces(this.modified,!1)!==this.cleanRemoveSpaces(i,!1)),this.modified&&(this.opts.fullpage&&""===i?this.setFullpageOnInit(i):(this.set(i),this.opts.fullpage&&this.buildBindKeyboard())),this.opts.iframe?this.$frame.show():this.$editor.show(),this.opts.fullpage&&this.$editor.attr("contenteditable",!0),this.$source.off("keydown.redactor-textarea"),this.$editor.focus(),this.selectionRestore(),this.observeStart(),this.buttonActiveVisual(),this.buttonInactive("html"),this.opts.visual=!0},autosave:function(){var t=!1;this.autosaveInterval=setInterval(e.proxy(function(){var i=this.get();t!==i&&e.ajax({url:this.opts.autosave,type:"post",data:this.$source.attr("name")+"="+escape(encodeURIComponent(i)),success:e.proxy(function(e){this.callback("autosave",!1,e),t=i},this)})},this),1e3*this.opts.autosaveInterval)},toolbarBuild:function(){if(this.opts.air)this.opts.buttons=this.opts.airButtons;else if(!this.opts.buttonSource){var t=this.opts.buttons.indexOf("html"),i=this.opts.buttons[t+1];this.opts.buttons.splice(t,1),"|"===i&&this.opts.buttons.splice(t,1)}if(e.extend(this.opts.toolbar,this.opts.buttonsCustom),e.each(this.opts.buttonsAdd,e.proxy(function(e,t){this.opts.buttons.push(t)},this)),this.opts.toolbar&&e.each(this.opts.toolbar.formatting.dropdown,e.proxy(function(t){"-1"==e.inArray(t,this.opts.formattingTags)&&delete this.opts.toolbar.formatting.dropdown[t]},this)),0===this.opts.buttons.length)return!1;if(this.airEnable(),this.$toolbar=e("<ul>").addClass("redactor_toolbar").attr("id","redactor_toolbar_"+this.uuid),this.opts.air?(this.$air=e('<div class="redactor_air">').attr("id","redactor_air_"+this.uuid).hide(),this.$air.append(this.$toolbar),e("body").append(this.$air)):this.opts.toolbarExternal?e(this.opts.toolbarExternal).html(this.$toolbar):this.$box.prepend(this.$toolbar),e.each(this.opts.buttons,e.proxy(function(t,i){if("|"===i)this.$toolbar.append(e(this.opts.buttonSeparator));else if(this.opts.toolbar[i]){var n=this.opts.toolbar[i];if(this.opts.fileUpload===!1&&"file"===i)return!0;this.$toolbar.append(e("<li>").append(this.buttonBuild(i,n)))}},this)),this.$toolbar.find("a").attr("tabindex","-1"),this.opts.toolbarFixed&&(this.toolbarObserveScroll(),e(document).on("scroll.redactor",e.proxy(this.toolbarObserveScroll,this))),this.opts.activeButtons){var n=e.proxy(this.buttonActiveObserver,this);this.$editor.on("mouseup.redactor keyup.redactor",n)}},toolbarObserveScroll:function(){var t=e(this.document).scrollTop(),i=this.$box.offset().top,n=0,s=i+this.$box.height()+40;if(t>i){var a="100%";this.opts.toolbarFixedBox&&(n=this.$box.offset().left,a=this.$box.innerWidth(),this.$toolbar.addClass("toolbar_fixed_box")),this.toolbarFixed=!0,this.$toolbar.css({position:"fixed",width:a,zIndex:1005,top:this.opts.toolbarFixedTopOffset+"px",left:n}),s>t?this.$toolbar.css("visibility","visible"):this.$toolbar.css("visibility","hidden")}else this.toolbarFixed=!1,this.$toolbar.css({position:"relative",width:"auto",top:0,left:n}),this.opts.toolbarFixedBox&&this.$toolbar.removeClass("toolbar_fixed_box")},airEnable:function(){this.opts.air&&this.$editor.on("mouseup.redactor keyup.redactor",this,e.proxy(function(t){var i=this.getSelectionText();if("mouseup"===t.type&&""!=i&&this.airShow(t),"keyup"===t.type&&t.shiftKey&&""!=i){var n=e(this.getElement(this.getSelection().focusNode)),s=n.offset();s.height=n.height(),this.airShow(s,!0)}},this))},airShow:function(t,i){if(this.opts.air){var n,s;if(e(".redactor_air").hide(),i)n=t.left,s=t.top+t.height+14,this.opts.iframe&&(s+=this.$box.position().top-e(this.document).scrollTop(),n+=this.$box.position().left);else{var a=this.$air.innerWidth();n=t.clientX,e(this.document).width()<n+a&&(n-=a),s=t.clientY+14,this.opts.iframe?(s+=this.$box.position().top,n+=this.$box.position().left):s+=e(this.document).scrollTop()}this.$air.css({left:n+"px",top:s+"px"}).show(),this.airBindHide()}},airBindHide:function(){if(this.opts.air){var t=e.proxy(function(t){e(t).on("mousedown.redactor",e.proxy(function(i){0===e(i.target).closest(this.$toolbar).length&&(this.$air.fadeOut(100),this.selectionRemove(),e(t).off(i))},this)).on("keydown.redactor",e.proxy(function(i){i.which===this.keyCode.ESC&&this.getSelection().collapseToStart(),this.$air.fadeOut(100),e(t).off(i)},this))},this);t(document),this.opts.iframe&&t(this.document)}},airBindMousemoveHide:function(){if(this.opts.air){var t=e.proxy(function(t){e(t).on("mousemove.redactor",e.proxy(function(i){0===e(i.target).closest(this.$toolbar).length&&(this.$air.fadeOut(100),e(t).off(i))},this))},this);t(document),this.opts.iframe&&t(this.document)}},pickerBuild:function(t,i){t.width(210);var n="color";"backcolor"===i&&(n="background-color");for(var s=this.opts.colors.length,a=this,o=0;s>o;o++){var r=this.opts.colors[o],l=e('<a rel="'+r+'" href="javascript:;" class="redactor_color_link"></a>').css({backgroundColor:r});t.append(l),l.on("click",function(){var t=e(this).attr("rel");"backcolor"===i&&(t=e(this).css("background-color")),a.pickerSet(n,t)})}var c=e('<a href="javascript:;" class="redactor_color_none"></a>').html(this.opts.curLang.none).on("click",function(){a.pickerSet(n,!1)});t.append(c)},pickerSet:function(e,t){this.bufferSet(),this.$editor.focus(),this.inlineRemoveStyle(e),t!==!1&&this.inlineSetStyle(e,t),this.opts.air&&this.$air.fadeOut(100),this.sync()},dropdownBuild:function(t,i){e.each(i,e.proxy(function(i,n){n.className||(n.className="");var s;"separator"===n.name?s=e('<a class="redactor_separator_drop">'):(s=e('<a href="javascript:;" class="'+n.className+" redactor_dropdown_"+i+'">'+n.title+"</a>"),s.on("click",e.proxy(function(e){e.preventDefault&&e.preventDefault(),this.browser("msie")&&(e.returnValue=!1),n.callback&&n.callback.call(this,i,s,n,e),n.exec&&this.execCommand(n.exec,i),n.func&&this[n.func](i),this.buttonActiveObserver(),this.opts.air&&this.$air.fadeOut(100)},this))),t.append(s)},this))},dropdownShow:function(t,i,n){if(!this.opts.visual)return t.preventDefault(),!1;if(this.buttonGet(n).hasClass("dropact"))this.dropdownHideAll();else{this.dropdownHideAll(),this.buttonActive(n),this.buttonGet(n).addClass("dropact");var s=this.buttonGet(n).position(),a=s.left+"px",o=29;this.opts.air?i.css({position:"absolute",left:a,top:o+"px"}).show():this.opts.toolbarFixed&&this.toolbarFixed?i.css({position:"fixed",left:a,top:o+"px"}).show():i.css({position:"absolute",left:a,top:s.top+o+"px"}).show()}var r=e.proxy(function(e){this.dropdownHide(e,i)},this);e(document).one("click",r),this.$editor.one("click",r),t.stopPropagation()},dropdownHideAll:function(){this.$toolbar.find("a.dropact").removeClass("redactor_act").removeClass("dropact"),e(".redactor_dropdown").hide()},dropdownHide:function(t,i){e(t.target).hasClass("dropact")||(i.removeClass("dropact"),this.dropdownHideAll())},buttonBuild:function(t,i){var n=e('<a href="javascript:;" title="'+i.title+'" class="redactor_btn redactor_btn_'+t+'"></a>'),s=e('<div class="redactor_dropdown" style="display: none;">');return n.on("click",e.proxy(function(e){return e.preventDefault&&e.preventDefault(),this.browser("msie")&&(e.returnValue=!1),n.hasClass("redactor_button_disabled")?!1:(this.isFocused()===!1&&this.$editor.focus(),i.exec?(this.execCommand(i.exec,t),this.airBindMousemoveHide()):i.func&&"show"!==i.func?(this[i.func](t),this.airBindMousemoveHide()):i.callback?(i.callback.call(this,t,n,i,e),this.airBindMousemoveHide()):("backcolor"===t||"fontcolor"===t||i.dropdown)&&this.dropdownShow(e,s,t),this.buttonActiveObserver(!1,t),void 0)},this)),("backcolor"===t||"fontcolor"===t||i.dropdown)&&(s.appendTo(this.$toolbar),"backcolor"===t||"fontcolor"===t?this.pickerBuild(s,t):this.dropdownBuild(s,i.dropdown)),n},buttonGet:function(t){return this.opts.toolbar?e(this.$toolbar.find("a.redactor_btn_"+t)):!1},buttonActiveToggle:function(e){var t=this.buttonGet(e);t.hasClass("redactor_act")?t.removeClass("redactor_act"):t.addClass("redactor_act")},buttonActive:function(e){this.buttonGet(e).addClass("redactor_act")},buttonInactive:function(e){this.buttonGet(e).removeClass("redactor_act")},buttonInactiveAll:function(t){e.each(this.opts.activeButtons,e.proxy(function(e,i){i!=t&&this.buttonInactive(i)},this))},buttonActiveVisual:function(){this.$toolbar.find("a.redactor_btn").not("a.redactor_btn_html").removeClass("redactor_button_disabled")
},buttonInactiveVisual:function(){this.$toolbar.find("a.redactor_btn").not("a.redactor_btn_html").addClass("redactor_button_disabled")},buttonChangeIcon:function(e,t){this.buttonGet(e).addClass("redactor_btn_"+t)},buttonRemoveIcon:function(e,t){this.buttonGet(e).removeClass("redactor_btn_"+t)},buttonAddSeparator:function(){this.$toolbar.append(e(this.opts.buttonSeparator))},buttonAddSeparatorAfter:function(t){this.buttonGet(t).parent().after(e(this.opts.buttonSeparator))},buttonAddSeparatorBefore:function(t){this.buttonGet(t).parent().before(e(this.opts.buttonSeparator))},buttonRemoveSeparatorAfter:function(e){this.buttonGet(e).parent().next().remove()},buttonRemoveSeparatorBefore:function(e){this.buttonGet(e).parent().prev().remove()},buttonSetRight:function(e){this.opts.toolbar&&this.buttonGet(e).parent().addClass("redactor_btn_right")},buttonSetLeft:function(e){this.opts.toolbar&&this.buttonGet(e).parent().removeClass("redactor_btn_right")},buttonAdd:function(t,i,n,s){if(this.opts.toolbar){var a=this.buttonBuild(t,{title:i,callback:n,dropdown:s});this.$toolbar.append(e("<li>").append(a))}},buttonAddFirst:function(t,i,n,s){if(this.opts.toolbar){var a=this.buttonBuild(t,{title:i,callback:n,dropdown:s});this.$toolbar.prepend(e("<li>").append(a))}},buttonAddAfter:function(t,i,n,s,a){if(this.opts.toolbar){var o=this.buttonBuild(i,{title:n,callback:s,dropdown:a}),r=this.buttonGet(t);r.parent().after(e("<li>").append(o))}},buttonAddBefore:function(t,i,n,s,a){if(this.opts.toolbar){var o=this.buttonBuild(i,{title:n,callback:s,dropdown:a}),r=this.buttonGet(t);r.parent().before(e("<li>").append(o))}},buttonRemove:function(e,t){var i=this.buttonGet(e);t&&i.parent().next().remove(),i.parent().removeClass("redactor_btn_right"),i.remove()},buttonActiveObserver:function(t,i){var n=this.getParent();if(this.buttonInactiveAll(i),t===!1)return this.buttonActiveToggle(i),void 0;n&&"A"===n.tagName?this.$toolbar.find("a.redactor_dropdown_link").text(this.opts.curLang.link_edit):this.$toolbar.find("a.redactor_dropdown_link").text(this.opts.curLang.link_insert),this.opts.activeButtonsAdd&&(e.each(this.opts.activeButtonsAdd,e.proxy(function(e,t){this.opts.activeButtons.push(t)},this)),e.extend(this.opts.activeButtonsStates,this.opts.activeButtonsAdd)),e.each(this.opts.activeButtonsStates,e.proxy(function(t,i){0!=e(n).closest(t,this.$editor.get()[0]).length&&this.buttonActive(i)},this));var s=e(n).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0]);if(s.length){var a=s.css("text-align");switch(a){case"right":this.buttonActive("alignright");break;case"center":this.buttonActive("aligncenter");break;case"justify":this.buttonActive("justify");break;default:this.buttonActive("alignleft")}}},exec:function(e,t,i){"formatblock"===e&&this.browser("msie")&&(t="<"+t+">"),"inserthtml"===e&&this.browser("msie")?(this.$editor.focus(),this.document.selection.createRange().pasteHTML(t)):this.document.execCommand(e,!1,t),i!==!1&&this.sync(),this.callback("execCommand",e,t)},execCommand:function(t,i,n){if(!this.opts.visual)return this.$source.focus(),!1;if("inserthtml"===t)return this.insertHtml(i,n),this.callback("execCommand",t,i),void 0;if(this.currentOrParentIs("PRE")&&!this.opts.formattingPre)return!1;if("insertunorderedlist"===t||"insertorderedlist"===t){var s=this.getParent(),a=e(s).closest("ol, ul"),o=!1;if(a.length){o=!0;var r=a[0].tagName;("insertunorderedlist"===t&&"OL"===r||"insertorderedlist"===t&&"UL"===r)&&(o=!1)}if(this.bufferSet(),this.selectionSave(),o){var l=this.getNodes(),c=this.getBlocks(l);"undefined"!=typeof l[0]&&l.length>1&&3==l[0].nodeType&&c.unshift(this.getBlock());var d="",h="";e.each(c,e.proxy(function(t,i){if("LI"==i.tagName){var n=e(i),s=n.clone();s.find("ul","ol").remove(),d+=this.opts.linebreaks===!1?this.outerHtml(e("<p>").append(s.contents())):s.html()+"<br>",0==t?(n.addClass("redactor-replaced").empty(),h=this.outerHtml(n)):n.remove()}},this)),html=this.$editor.html().replace(h,"</"+r+">"+d+"<"+r+">"),this.$editor.html(html),this.$editor.find(r+":empty").remove(),this.selectionRestore()}else{this.document.execCommand(t);var s=this.getParent(),a=e(s).parents("ol, ul");if(a.length){(this.browser("msie")||this.browser("mozilla"))&&"LI"!==s.tagName&&e(s).replaceWith(e(s).html());var u=a.parent();this.isParentRedactor(u)&&this.nodeTestBlocks(u[0])&&u.replaceWith(u.contents())}this.browser("mozilla")&&this.$editor.focus(),this.selectionRestore()}return this.sync(),this.callback("execCommand",t,i),void 0}if("unlink"===t){this.bufferSet();var s=this.getParent();if("A"===e(s)[0].tagName)return e(s).replaceWith(e(s).text()),this.sync(),this.callback("execCommand",t,i),void 0}this.exec(t,i,n),"inserthorizontalrule"===t&&this.$editor.find("hr").removeAttr("id")},indentingIndent:function(){this.indentingStart("indent")},indentingOutdent:function(){this.indentingStart("outdent")},indentingStart:function(t){if("indent"===t){var i=this.getBlock();if(i&&"LI"==i.tagName){this.selectionSave();var n=this.getParent(),s=e(n).closest("ol, ul"),a=s[0].tagName,o=this.getBlocks();e.each(o,function(t,i){if("LI"==i.tagName){var n=e(i).prev();if(0!=n.size()&&"LI"==n[0].tagName){var s=n.children("ul, ol");0==s.size()?n.append(e("<"+a+">").append(i)):s.append(i)}}}),this.selectionRestore()}}else{this.selectionSave();var i=this.getBlock();if(i&&"LI"==i.tagName){var o=this.getBlocks(),r=0;this.insideOutdent(i,r,o)}this.selectionRestore()}},insideOutdent:function(t,i,n){if(t&&"LI"==t.tagName){var s=e(t).parent().parent();0!=s.size()&&"LI"==s[0].tagName?s.after(t):"undefined"!=typeof n[i]?(t=n[i],i++,this.insideOutdent(t,i,n)):this.execCommand("insertunorderedlist")}},cleanEmpty:function(e){var t=this.placeholderStart(e);return t!==!1?t:(this.opts.linebreaks===!1&&(""===e?e=this.opts.emptyHtml:-1!==e.search(/^<hr\s?\/?>$/gi)&&(e="<hr>"+this.opts.emptyHtml)),e)},cleanConverters:function(e){return this.opts.convertDivs&&(e=e.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p$1>$2</p>")),this.opts.paragraphy&&(e=this.cleanParagraphy(e)),e},cleanConvertProtected:function(e){return e=e.replace(/<script(.*?)>([\w\W]*?)<\/script>/gi,'<title type="text/javascript" style="display: none;" class="redactor-script-tag"$1>$2</title>'),e=e.replace(/<style(.*?)>([\w\W]*?)<\/style>/gi,'<section$1 style="display: none;" rel="redactor-style-tag">$2</section>'),e=e.replace(/<form(.*?)>([\w\W]*?)<\/form>/gi,'<section$1 rel="redactor-form-tag">$2</section>'),e=this.opts.phpTags?e.replace(/<\?php([\w\W]*?)\?>/gi,'<section style="display: none;" rel="redactor-php-tag">$1</section>'):e.replace(/<\?php([\w\W]*?)\?>/gi,"")},cleanReConvertProtected:function(e){return e=e.replace(/<title type="text\/javascript" style="display: none;" class="redactor-script-tag"(.*?)>([\w\W]*?)<\/title>/gi,'<script$1 type="text/javascript">$2</script>'),e=e.replace(/<section(.*?) style="display: none;" rel="redactor-style-tag">([\w\W]*?)<\/section>/gi,"<style$1>$2</style>"),e=e.replace(/<section(.*?)rel="redactor-form-tag"(.*?)>([\w\W]*?)<\/section>/gi,"<form$1$2>$3</form>"),this.opts.phpTags&&(e=e.replace(/<section style="display: none;" rel="redactor-php-tag">([\w\W]*?)<\/section>/gi,"<?php\r\n$1\r\n?>")),e},cleanRemoveSpaces:function(t,i){if(i!==!1){var n,i=[],s=0;n=t.match(/<(pre|style|script|title)(.*?)>([\w\W]*?)<\/(pre|style|script|title)>/gi),null!==n&&e.each(n,function(e,n){s=e,t=t.replace(n,"buffer_"+s),i.push(n)}),this.opts.phpTags&&(n=t.match(/<\?php([\w\W]*?)\?>/gi),null!==n&&e.each(n,function(e,n){s+=e,t=t.replace(n,"buffer_"+e),i.push(n)}))}return t=t.replace(/\n/g," "),t=t.replace(/[\t]*/g,""),t=t.replace(/\n\s*\n/g,"\n"),t=t.replace(/^[\s\n]*/g," "),t=t.replace(/[\s\n]*$/g," "),t=t.replace(/>\s{2,}</g,"><"),i!==!1&&(t=this.cleanReplacer(i,t)),t=t.replace(/\n\n/g,"\n")},cleanReplacer:function(t,i){return t&&e.each(t,function(e,t){i=i.replace("buffer_"+e,t)}),i},cleanRemoveEmptyTags:function(e){e=e.replace(/<span>([\w\W]*?)<\/span>/gi,"$1"),e=e.replace(/[\u200B-\u200D\uFEFF]/g,"");for(var t=["<pre></pre>","<blockquote>\\s*</blockquote>","<dd></dd>","<dt></dt>","<em>\\s*</em>","<ul></ul>","<ol></ol>","<li></li>","<table></table>","<tr></tr>","<span>\\s*<span>","<span>&nbsp;<span>","<b>\\s*</b>","<b>&nbsp;</b>","<p>\\s*</p>","<p></p>","<p>&nbsp;</p>","<p>\\s*<br>\\s*</p>","<div>\\s*</div>","<div>\\s*<br>\\s*</div>"],i=t.length,n=0;i>n;++n)e=e.replace(new RegExp(t[n],"gi"),"");return e},cleanParagraphy:function(t){function i(e,i,n){return t.replace(new RegExp(e,i),n)}if(t=e.trim(t),this.opts.linebreaks===!0)return t;if(""===t||"<p></p>"===t)return this.opts.emptyHtml;t+="\n";var n=[],s=0;-1!==t.search(/<(table|div|pre|object)/gi)&&e.each(t.match(/<(table|div|pre|object)(.*?)>([\w\W]*?)<\/(table|div|pre|object)>/gi),function(e,i){s++,n[s]=i,t=t.replace(i,"{replace"+s+"}\n")}),this.opts.phpTags&&-1!==t.search(/<section(.*?)rel="redactor-php-tag">/gi)&&e.each(t.match(/<section(.*?)rel="redactor-php-tag">([\w\W]*?)<\/section>/gi),function(e,i){s++,n[s]=i,t=t.replace(i,"{replace"+s+"}\n")}),t=t.replace(/<\!\-\-([\w\W]*?)\-\->/gi,"<comment>$1</comment>"),t=t.replace(/<br \/>\s*<br \/>/gi,"\n\n");var a="(comment|html|body|head|title|meta|style|script|link|iframe|table|thead|tfoot|caption|col|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|option|form|map|area|blockquote|address|math|style|p|h[1-6]|hr|fieldset|legend|section|article|aside|hgroup|header|footer|nav|figure|figcaption|details|menu|summary)";t=i("(<"+a+"[^>]*>)","gi","\n$1"),t=i("(</"+a+">)","gi","$1\n\n"),t=i("\r\n","g","\n"),t=i("\r","g","\n"),t=i("/\n\n+/","g","\n\n");var o=t.split(new RegExp("\ns*\n","g"),-1);t="";for(var r in o)o.hasOwnProperty(r)&&(t+=-1==o[r].search("{replace")?"<p>"+o[r].replace(/^\n+|\n+$/g,"")+"</p>":o[r]);return-1!==t.search(/<blockquote/gi)&&e.each(t.match(/<blockquote(.*?)>([\w\W]*?)<\/blockquote>/gi),function(e,i){var n="";n=i.replace("<p>",""),n=n.replace("</p>","<br>"),t=t.replace(i,n)}),t=i("<p>s*</p>","gi",""),t=i("<p>([^<]+)</(div|address|form)>","gi","<p>$1</p></$2>"),t=i("<p>s*(</?"+a+"[^>]*>)s*</p>","gi","$1"),t=i("<p>(<li.+?)</p>","gi","$1"),t=i("<p>s*(</?"+a+"[^>]*>)","gi","$1"),t=i("(</?"+a+"[^>]*>)s*</p>","gi","$1"),t=i("(</?"+a+"[^>]*>)s*<br />","gi","$1"),t=i("<br />(s*</?(?:p|li|div|dl|dd|dt|th|pre|td|ul|ol)[^>]*>)","gi","$1"),t=i("\n</p>","gi","</p>"),t=i("</li><p>","gi","</li>"),t=i("</ul><p>(.*?)</li>","gi","</ul></li>"),t=i("</ol><p>","gi","</ol>"),t=i("<p>	?\n?<p>","gi","<p>"),t=i("</dt><p>","gi","</dt>"),t=i("</dd><p>","gi","</dd>"),t=i("<br></p></blockquote>","gi","</blockquote>"),e.each(n,function(e,i){t=t.replace("{replace"+e+"}",i)}),t=t.replace(/<comment>([\w\W]*?)<\/comment>/gi,"<!--$1-->"),e.trim(t)},cleanConvertInlineTags:function(e){var t="strong";"b"===this.opts.boldTag&&(t="b");var i="em";return"i"===this.opts.italicTag&&(i="i"),e=e.replace(/<span style="font-style: italic;">([\w\W]*?)<\/span>/gi,"<"+i+">$1</"+i+">"),e=e.replace(/<span style="font-weight: bold;">([\w\W]*?)<\/span>/gi,"<"+t+">$1</"+t+">"),e="strong"===this.opts.boldTag?e.replace(/<b>([\w\W]*?)<\/b>/gi,"<strong>$1</strong>"):e.replace(/<strong>([\w\W]*?)<\/strong>/gi,"<b>$1</b>"),e="em"===this.opts.italicTag?e.replace(/<i>([\w\W]*?)<\/i>/gi,"<em>$1</em>"):e.replace(/<em>([\w\W]*?)<\/em>/gi,"<i>$1</i>"),e=e.replace(/<strike>([\w\W]*?)<\/strike>/gi,"<del>$1</del>"),/<span(.*?)data-redactor="verified"(.*?)>([\w\W]*?)<\/span>/gi.test(e)||(e=e.replace(/<span(.*?)(?!data-redactor="verified")(.*?)>([\w\W]*?)<\/span>/gi,'<span$1 data-redactor="verified"$2>$3</span>')),e},cleanStripTags:function(t){if(""==t||"undefined"==typeof t)return t;var i=!1;this.opts.allowedTags!==!1&&(i=!0);var n=i===!0?this.opts.allowedTags:this.opts.deniedTags,s=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return t=t.replace(s,function(t,s){return i===!0?e.inArray(s.toLowerCase(),n)>"-1"?t:"":e.inArray(s.toLowerCase(),n)>"-1"?"":t}),t=this.cleanConvertInlineTags(t)},cleanSavePreCode:function(t,i){var n=t.match(/<(pre|code)(.*?)>([\w\W]*?)<\/(pre|code)>/gi);return null!==n&&e.each(n,e.proxy(function(e,n){var s=n.match(/<(pre|code)(.*?)>([\w\W]*?)<\/(pre|code)>/i);s[3]=s[3].replace(/&nbsp;/g," "),i!==!1&&(s[3]=this.cleanEncodeEntities(s[3])),t=t.replace(n,"<"+s[1]+s[2]+">"+s[3]+"</"+s[1]+">")},this)),t},cleanEncodeEntities:function(e){return e=String(e).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"'),String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},cleanUnverified:function(){var t=this.$editor.find("img, a, b, strong, sub, sup, i, em, u, small, strike, del, span, cite");t.filter('[style*="font-size"][style*="line-height"]').css("font-size","").css("line-height",""),t.filter('[style*="background-color: transparent;"][style*="line-height"]').css("background-color","").css("line-height",""),t.filter('[style*="background-color: transparent;"]').css("background-color",""),e.each(t,e.proxy(function(e,t){this.removeEmptyAttr(t,"style")},this)),this.$editor.find('div[style="text-align: -webkit-auto;"]').contents().unwrap()},cleanHtml:function(e){var t=0,i=e.length,n=0,s=null,a=null,o="",r="",l="";for(this.cleanlevel=0;i>t;t++){if(n=t,-1==e.substr(t).indexOf("<"))return r+=e.substr(t),this.cleanFinish(r);for(;i>n&&"<"!=e.charAt(n);)n++;for(t!=n&&(l=e.substr(t,n-t),l.match(/^\s{2,}$/g)||("\n"==r.charAt(r.length-1)?r+=this.cleanGetTabs():"\n"==l.charAt(0)&&(r+="\n"+this.cleanGetTabs(),l=l.replace(/^\s+/,"")),r+=l),l.match(/\n/)&&(r+="\n"+this.cleanGetTabs())),s=n;i>n&&">"!=e.charAt(n);)n++;o=e.substr(s,n-s),t=n;var c;if("!--"==o.substr(1,3)){if(!o.match(/--$/)){for(;"-->"!=e.substr(n,3);)n++;n+=2,o=e.substr(s,n-s),t=n}"\n"!=r.charAt(r.length-1)&&(r+="\n"),r+=this.cleanGetTabs(),r+=o+">\n"}else"!"==o[1]?r=this.placeTag(o+">",r):"?"==o[1]?r+=o+">\n":(c=o.match(/^<(script|style|pre)/i))?(c[1]=c[1].toLowerCase(),o=this.cleanTag(o),r=this.placeTag(o,r),a=String(e.substr(t+1)).toLowerCase().indexOf("</"+c[1]),a&&(l=e.substr(t+1,a),t+=a,r+=l)):(o=this.cleanTag(o),r=this.placeTag(o,r))}return this.cleanFinish(r)},cleanGetTabs:function(){for(var e="",t=0;t<this.cleanlevel;t++)e+="	";return e},cleanFinish:function(e){return e=e.replace(/\n\s*\n/g,"\n"),e=e.replace(/^[\s\n]*/,""),e=e.replace(/[\s\n]*$/,""),e=e.replace(/<script(.*?)>\n<\/script>/gi,"<script$1></script>"),this.cleanlevel=0,e},cleanTag:function(e){var t="";e=e.replace(/\n/g," "),e=e.replace(/\s{2,}/g," "),e=e.replace(/^\s+|\s+$/g," ");var i="";e.match(/\/$/)&&(i="/",e=e.replace(/\/+$/,""));for(var n;n=/\s*([^= ]+)(?:=((['"']).*?\3|[^ ]+))?/.exec(e);)n[2]?t+=n[1].toLowerCase()+"="+n[2]:n[1]&&(t+=n[1].toLowerCase()),t+=" ",e=e.substr(n[0].length);return t.replace(/\s*$/,"")+i+">"},placeTag:function(e,t){var i=e.match(this.cleannewLevel);return(e.match(this.cleanlineBefore)||i)&&(t=t.replace(/\s*$/,""),t+="\n"),i&&"/"==e.charAt(1)&&this.cleanlevel--,"\n"==t.charAt(t.length-1)&&(t+=this.cleanGetTabs()),i&&"/"!=e.charAt(1)&&this.cleanlevel++,t+=e,(e.match(this.cleanlineAfter)||e.match(this.cleannewLevel))&&(t=t.replace(/ *$/,""),t+="\n"),t},alignmentLeft:function(){this.alignmentSet("","JustifyLeft")},alignmentRight:function(){this.alignmentSet("right","JustifyRight")},alignmentCenter:function(){this.alignmentSet("center","JustifyCenter")},alignmentJustify:function(){this.alignmentSet("justify","JustifyFull")},alignmentSet:function(t,i){if(this.bufferSet(),this.oldIE())return this.document.execCommand(i,!1,!1),!0;this.selectionSave();var n=this.getBlocks();e.each(n,e.proxy(function(i,n){var s=!1;s=-1!==e.inArray(n.tagName,this.opts.alignmentTags)?e(n):e(n).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0]),s&&(s.css("text-align",t),this.removeEmptyAttr(s,"style"))},this)),this.selectionRestore(),this.sync()},formatEmpty:function(t){var i=e.trim(this.$editor.html());i=i.replace(/<br\s?\/?>/i,"");var n=i.replace(/<p>\s?<\/p>/gi,"");if(""===i||""===n){t.preventDefault();var s=e(this.opts.emptyHtml).get(0);this.$editor.html(s),this.focus()}this.sync()},formatBlocks:function(t){this.bufferSet();var i=this.getBlocks();this.selectionSave(),e.each(i,e.proxy(function(e,i){"LI"!==i.tagName&&this.formatBlock(t,i)},this)),this.selectionRestore(),this.sync()},formatBlock:function(t,i){if(i===!1&&(i=this.getBlock()),i===!1)return this.opts.linebreaks===!0&&this.execCommand("formatblock",t),!0;var n="";if("pre"!==t?n=e(i).contents():(n=e(i).html(),""===e.trim(n)&&(n='<span id="selection-marker-1"></span>')),"PRE"===i.tagName&&(t="p"),this.opts.linebreaks===!0&&"p"===t)e(i).replaceWith(e("<div>").append(n).html()+"<br>");else{var s=e("<"+t+">").append(n);e(i).replaceWith(s)}},formatChangeTag:function(t,i,n){n!==!1&&this.selectionSave();var s=e("<"+i+"/>");return e(t).replaceWith(function(){return s.append(e(this).contents())}),n!==!1&&this.selectionRestore(),s},formatQuote:function(){if(this.bufferSet(),this.opts.linebreaks===!1){this.selectionSave();var t=this.getBlocks();t&&e.each(t,e.proxy(function(e,t){"BLOCKQUOTE"===t.tagName?this.formatBlock("p",t,!1):"LI"!==t.tagName&&this.formatBlock("blockquote",t,!1)},this)),this.selectionRestore()}else{var i=this.getBlock();if("BLOCKQUOTE"===i.tagName)this.selectionSave(),e(i).replaceWith(e(i).html()+"<br>"),this.selectionRestore();else{var n=this.selectionWrap("blockquote"),s=e(n).html(),a=["ul","ol","table","tr","tbody","thead","tfoot","dl"];e.each(a,function(e,t){s=s.replace(new RegExp("<"+t+"(.*?)>","gi"),""),s=s.replace(new RegExp("</"+t+">","gi"),"")});var o=this.opts.blockLevelElements;o.push("td"),e.each(o,function(e,t){s=s.replace(new RegExp("<"+t+"(.*?)>","gi"),""),s=s.replace(new RegExp("</"+t+">","gi"),"<br>")}),e(n).html(s),this.selectionElement(n);var r=e(n).next();"BR"===r[0].tagName&&r.remove()}}this.sync()},blockRemoveAttr:function(t){var i=this.getBlocks();e(i).removeAttr(t),this.sync()},blockSetAttr:function(t,i){var n=this.getBlocks();e(n).attr(t,i),this.sync()},blockRemoveStyle:function(t){var i=this.getBlocks();e(i).css(t,""),this.removeEmptyAttr(i,"style"),this.sync()},blockSetStyle:function(t,i){var n=this.getBlocks();e(n).css(t,i),this.sync()},blockRemoveClass:function(t){var i=this.getBlocks();e(i).removeClass(t),this.removeEmptyAttr(i,"class"),this.sync()},blockSetClass:function(t){var i=this.getBlocks();e(i).addClass(t),this.sync()},inlineRemoveClass:function(t){this.selectionSave(),this.inlineEachNodes(function(i){e(i).removeClass(t),this.removeEmptyAttr(i,"class")}),this.selectionRestore(),this.sync()},inlineSetClass:function(t){var i=this.getCurrent();e(i).hasClass(t)||this.inlineMethods("addClass",t)},inlineRemoveStyle:function(t){this.selectionSave(),this.inlineEachNodes(function(i){e(i).css(t,""),this.removeEmptyAttr(i,"style")}),this.selectionRestore(),this.sync()},inlineSetStyle:function(e,t){this.inlineMethods("css",e,t)},inlineRemoveAttr:function(t){this.selectionSave();var i=this.getRange(),n=this.getElement(),s=this.getNodes();(i.collapsed||i.startContainer===i.endContainer&&n)&&(s=e(n)),e(s).removeAttr(t),this.inlineUnwrapSpan(),this.selectionRestore(),this.sync()},inlineSetAttr:function(e,t){this.inlineMethods("attr",e,t)},inlineMethods:function(t,i,n){this.selectionSave();var s=this.getRange(),a=this.getElement();if(s.collapsed||s.startContainer===s.endContainer&&a)e(a)[t](i,n);else{this.document.execCommand("fontSize",!1,4);var o=this.$editor.find("font");e.each(o,e.proxy(function(e,s){this.inlineSetMethods(t,s,i,n)},this))}this.selectionRestore(),this.sync()},inlineSetMethods:function(t,i,n,s){var a,o=e(i).parent();return o&&"SPAN"===o[0].tagName?(a=o,e(i).replaceWith(e(i).html())):(a=e('<span data-redactor="verified" data-redactor-inlineMethods>').append(e(i).contents()),e(i).replaceWith(a)),e(a)[t](n,s),a},inlineEachNodes:function(t){var i,n=this.getRange(),s=this.getElement(),a=this.getNodes();(n.collapsed||n.startContainer===n.endContainer&&s)&&(a=e(s),i=!0),e.each(a,e.proxy(function(n,s){if(!i&&"SPAN"!==s.tagName){if("SPAN"!==s.parentNode.tagName||e(s.parentNode).hasClass("redactor_editor"))return;s=s.parentNode}t.call(this,s)},this))},inlineUnwrapSpan:function(){var t=this.$editor.find("span[data-redactor-inlineMethods]");e.each(t,e.proxy(function(t,i){var n=e(i);void 0===n.attr("class")&&void 0===n.attr("style")&&n.contents().unwrap()},this))},inlineFormat:function(t){this.selectionSave(),this.document.execCommand("fontSize",!1,4);var i,n=this.$editor.find("font");e.each(n,function(n,s){var a=e("<"+t+"/>").append(e(s).contents());e(s).replaceWith(a),i=a}),this.selectionRestore(),this.sync()},inlineRemoveFormat:function(t){this.selectionSave();var i=t.toUpperCase(),n=this.getNodes();e.each(n,function(t,n){n.tagName===i&&e(n).replaceWith(e(n).contents())}),this.selectionRestore(),this.sync()},insertHtml:function(t,i){var n=this.getCurrent(),s=n.parentNode;this.$editor.focus(),this.bufferSet();var a=e("<div>").append(e.parseHTML(t));t=a.html(),t=this.cleanRemoveEmptyTags(t),a=e("<div>").append(e.parseHTML(t));var o=this.getBlock();if(1==a.contents().length){var r=a.contents()[0].tagName;("P"!=r&&r==o.tagName||"PRE"==r)&&(t=a.text(),a=e("<div>").append(t))}!this.opts.linebreaks&&1==a.contents().length&&3==a.contents()[0].nodeType&&(this.getRangeSelectedNodes().length>2||!n||"BODY"==n.tagName&&!s||"HTML"==s.tagName)&&(t="<p>"+t+"</p>"),"BLOCKQUOTE"==o.tagName&&-1===t.indexOf("<a")?this.insertText(t):a.contents().length>1&&o||a.contents().is("p, :header, ul, ol, div, table, blockquote, pre, address, section, header, footer, aside, article")?this.browser("msie")?this.document.selection.createRange().pasteHTML(t):this.document.execCommand("inserthtml",!1,t):this.insertHtmlAdvanced(t),this.selectall&&this.window.setTimeout(e.proxy(function(){this.opts.linebreaks?this.focusEnd():this.selectionEnd(this.$editor.contents().last())},this),1),this.observeStart(),i!==!1&&this.sync()},insertHtmlAdvanced:function(e){var t=this.getSelection();if(t.getRangeAt&&t.rangeCount){var i=t.getRangeAt(0);i.deleteContents();var n=this.document.createElement("div");n.innerHTML=e;for(var s,a,o=this.document.createDocumentFragment();s=n.firstChild;)a=o.appendChild(s);i.insertNode(o),a&&(i=i.cloneRange(),i.setStartAfter(a),i.collapse(!0),t.removeAllRanges(),t.addRange(i))}},insertText:function(t){var i=e(e.parseHTML(t));i.length&&(t=i.text()),this.$editor.focus(),this.browser("msie")?this.document.selection.createRange().pasteHTML(t):this.document.execCommand("inserthtml",!1,t),this.sync()},insertNode:function(e){e=e[0]||e;var t=this.getSelection();t.getRangeAt&&t.rangeCount&&(range=t.getRangeAt(0),range.deleteContents(),range.insertNode(e),range.setEndAfter(e),range.setStartAfter(e),t.removeAllRanges(),t.addRange(range))},insertAfterLastElement:function(t){if(this.isEndOfElement()){if(this.$editor.contents().last()[0]!==t)return!1;if(this.bufferSet(),this.opts.linebreaks===!1){var i=e(this.opts.emptyHtml);e(t).after(i),this.selectionStart(i)}else{var i=e('<span id="selection-marker-1">'+this.opts.invisibleSpace+"</span>",this.document)[0];e(t).after(i),e(i).after(this.opts.invisibleSpace),this.selectionRestore()}}},insertLineBreak:function(){this.selectionSave(),this.$editor.find("#selection-marker-1").before("<br>"+(this.browser("webkit")?this.opts.invisibleSpace:"")),this.selectionRestore()},insertDoubleLineBreak:function(){this.selectionSave(),this.$editor.find("#selection-marker-1").before("<br><br>"+(this.browser("webkit")?this.opts.invisibleSpace:"")),this.selectionRestore()},replaceLineBreak:function(t){var i=e("<br>"+this.opts.invisibleSpace);e(t).replaceWith(i),this.selectionStart(i)},pasteClean:function(e){if(e=this.callback("pasteBefore",!1,e),this.currentOrParentIs("PRE"))return e=this.pastePre(e),this.pasteInsert(e),!0;if(e=e.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,""),e=e.replace(/(&nbsp;){2,}/gi,"&nbsp;"),e=e.replace(/&nbsp;/gi," "),e=e.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2"),e=this.cleanStripTags(e),e=e.replace(/<td><\/td>/gi,"[td]"),e=e.replace(/<td>&nbsp;<\/td>/gi,"[td]"),e=e.replace(/<td><br><\/td>/gi,"[td]"),e=e.replace(/<a(.*?)href="(.*?)"(.*?)>([\w\W]*?)<\/a>/gi,'[a href="$2"]$4[/a]'),e=e.replace(/<iframe(.*?)>([\w\W]*?)<\/iframe>/gi,"[iframe$1]$2[/iframe]"),e=e.replace(/<video(.*?)>([\w\W]*?)<\/video>/gi,"[video$1]$2[/video]"),e=e.replace(/<audio(.*?)>([\w\W]*?)<\/audio>/gi,"[audio$1]$2[/audio]"),e=e.replace(/<embed(.*?)>([\w\W]*?)<\/embed>/gi,"[embed$1]$2[/embed]"),e=e.replace(/<object(.*?)>([\w\W]*?)<\/object>/gi,"[object$1]$2[/object]"),e=e.replace(/<param(.*?)>/gi,"[param$1]"),e=e.replace(/<img(.*?)style="(.*?)"(.*?)>/gi,"[img$1$3]"),e=e.replace(/<(\w+)([\w\W]*?)>/gi,"<$1>"),e=e.replace(/<[^\/>][^>]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,""),e=e.replace(/<div>\s*?\t*?\n*?(<ul>|<ol>|<p>)/gi,"$1"),e=e.replace(/\[td\]/gi,"<td>&nbsp;</td>"),e=e.replace(/\[a href="(.*?)"\]([\w\W]*?)\[\/a\]/gi,'<a href="$1">$2</a>'),e=e.replace(/\[iframe(.*?)\]([\w\W]*?)\[\/iframe\]/gi,"<iframe$1>$2</iframe>"),e=e.replace(/\[video(.*?)\]([\w\W]*?)\[\/video\]/gi,"<video$1>$2</video>"),e=e.replace(/\[audio(.*?)\]([\w\W]*?)\[\/audio\]/gi,"<audio$1>$2</audio>"),e=e.replace(/\[embed(.*?)\]([\w\W]*?)\[\/embed\]/gi,"<embed$1>$2</embed>"),e=e.replace(/\[object(.*?)\]([\w\W]*?)\[\/object\]/gi,"<object$1>$2</object>"),e=e.replace(/\[param(.*?)\]/gi,"<param$1>"),e=e.replace(/\[img(.*?)\]/gi,"<img$1>"),this.opts.convertDivs&&(e=e.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2</p>"),e=e.replace(/<\/div><p>/gi,"<p>"),e=e.replace(/<\/p><\/div>/gi,"</p>")),e=this.cleanParagraphy(e),e=e.replace(/<span(.*?)>([\w\W]*?)<\/span>/gi,"$2"),e=e.replace(/<img>/gi,""),e=e.replace(/<[^\/>][^>][^img|param|source]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,""),e=e.replace(/\n{3,}/gi,"\n"),e=e.replace(/<p><p>/gi,"<p>"),e=e.replace(/<\/p><\/p>/gi,"</p>"),e=e.replace(/<li>(\s*|\t*|\n*)<p>/gi,"<li>"),e=e.replace(/<\/p>(\s*|\t*|\n*)<\/li>/gi,"</li>"),this.opts.linebreaks===!0&&(e=e.replace(/<p(.*?)>([\w\W]*?)<\/p>/gi,"$2<br>")),e=e.replace(/<[^\/>][^>][^img|param|source]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,""),this.browser("mozilla"))for(;/<br>$/gi.test(e);)e=e.replace(/<br>$/gi,"");for(;/<font>([\w\W]*?)<\/font>/gi.test(e);)e=e.replace(/<font>([\w\W]*?)<\/font>/gi,"$1");this.pasteInsert(e)},pastePre:function(e){e=e.replace(/<br>|<\/H[1-6]>|<\/p>|<\/div>/gi,"\n");var t=this.document.createElement("div");return t.innerHTML=e,this.cleanEncodeEntities(t.textContent||t.innerText)},pasteInsert:function(t){this.selectall&&(this.opts.linebreaks?this.$editor.html(""):this.$editor.html(this.opts.emptyHtml),this.$editor.focus()),t=this.callback("pasteAfter",!1,t),this.insertHtml(t),this.selectall=!1,setTimeout(function(){n=!1},100),this.opts.autoresize?e(this.document.body).scrollTop(this.saveScroll):this.$editor.scrollTop(this.saveScroll)},bufferSet:function(e){void 0!==e?this.opts.buffer.push(e):(this.selectionSave(),this.opts.buffer.push(this.$editor.html()),this.selectionRemoveMarkers(!0))},bufferUndo:function(){return 0===this.opts.buffer.length?(this.$editor.focus(),void 0):(this.selectionSave(),this.opts.rebuffer.push(this.$editor.html()),this.selectionRestore(!1,!0),this.$editor.html(this.opts.buffer.pop()),this.selectionRestore(),setTimeout(e.proxy(this.observeStart,this),100),void 0)},bufferRedo:function(){return 0===this.opts.rebuffer.length?(this.$editor.focus(),!1):(this.selectionSave(),this.opts.buffer.push(this.$editor.html()),this.selectionRestore(!1,!0),this.$editor.html(this.opts.rebuffer.pop()),this.selectionRestore(!0),setTimeout(e.proxy(this.observeStart,this),4),void 0)},observeStart:function(){this.observeImages(),this.observeTables()},observeTables:function(){this.$editor.find("table").on("click",e.proxy(this.tableObserver,this))},observeImages:function(){return this.opts.observeImages===!1?!1:(this.$editor.find("img").each(e.proxy(function(t,i){this.browser("msie")&&e(i).attr("unselectable","on"),this.imageResize(i)},this)),void 0)},getSelection:function(){return this.opts.rangy?this.opts.iframe?rangy.getSelection(this.$frame[0]):rangy.getSelection():this.document.getSelection()},getRange:function(){if(this.opts.rangy)return this.opts.iframe?rangy.createRange(this.iframeDoc()):rangy.createRange();if(this.document.getSelection){var e=this.document.getSelection();if(e.getRangeAt&&e.rangeCount)return e.getRangeAt(0)}return this.document.createRange()},selectionElement:function(e){this.setCaret(e)},selectionStart:function(e){this.selectionSet(e[0]||e,0,null,0)},selectionEnd:function(e){this.selectionSet(e[0]||e,1,null,1)},selectionSet:function(e,t,i,n){null==i&&(i=e),null==n&&(n=t);var s=this.getSelection();if(s){var a=this.getRange();a.setStart(e,t),a.setEnd(i,n);try{s.removeAllRanges()}catch(o){}s.addRange(a)}},selectionWrap:function(e){e=e.toLowerCase();var t=this.getBlock();if(t){var i=this.formatChangeTag(t,e);return this.sync(),i}var n=this.getSelection(),s=n.getRangeAt(0),i=document.createElement(e);return i.appendChild(s.extractContents()),s.insertNode(i),this.selectionElement(i),i},selectionAll:function(){var e=this.getRange();e.selectNodeContents(this.$editor[0]);var t=this.getSelection();t.removeAllRanges(),t.addRange(e)},selectionRemove:function(){this.getSelection().removeAllRanges()},getCaretOffset:function(t){var i=0,n=this.getSelection().getRangeAt(0),s=n.cloneRange();return s.selectNodeContents(t),s.setEnd(n.endContainer,n.endOffset),i=e.trim(s.toString()).length},getCaretOffsetRange:function(){return new s(this.getSelection().getRangeAt(0))},setCaret:function(e,t,i){"undefined"==typeof i&&(i=t),e=e[0]||e;var n=this.getRange();n.selectNodeContents(e);var s,a=this.getTextNodesIn(e),o=!1,r=0;if(1==a.length&&t)n.setStart(a[0],t),n.setEnd(a[0],i);else for(var l,c=0;l=a[c++];){if(s=r+l.length,!o&&t>=r&&(s>t||t==s&&c<a.length)&&(n.setStart(l,t-r),o=!0),o&&s>=i){n.setEnd(l,i-r);break}r=s}var d=this.getSelection();d.removeAllRanges(),d.addRange(n)},getTextNodesIn:function(e){var t=[];if(3==e.nodeType)t.push(e);else for(var i=e.childNodes,n=0,s=i.length;s>n;++n)t.push.apply(t,this.getTextNodesIn(i[n]));return t},selectionSave:function(){this.isFocused()||this.$editor.focus(),this.opts.rangy?this.savedSel=rangy.saveSelection():this.selectionCreateMarker(this.getRange())},selectionCreateMarker:function(t){if(t){var i=e('<span id="selection-marker-1">'+this.opts.invisibleSpace+"</span>",this.document)[0],n=e('<span id="selection-marker-2">'+this.opts.invisibleSpace+"</span>",this.document)[0];t.collapsed===!0?this.selectionSetMarker(t,i,!0):(this.selectionSetMarker(t,i,!0),this.selectionSetMarker(t,n,!1)),this.savedSel=this.$editor.html(),this.selectionRestore(!1,!1)}},selectionSetMarker:function(e,t,i){var n=e.cloneRange();n.collapse(i),n.insertNode(t),n.detach()},selectionRestore:function(e,t){if(this.opts.rangy)rangy.restoreSelection(this.savedSel);else{e===!0&&this.savedSel&&this.$editor.html(this.savedSel);var i=this.$editor.find("span#selection-marker-1"),n=this.$editor.find("span#selection-marker-2");this.isFocused()||this.$editor.focus(),0!=i.length&&0!=n.length?this.selectionSet(i[0],0,n[0],0):0!=i.length&&this.selectionSet(i[0],0,null,0),t!==!1&&(this.selectionRemoveMarkers(),this.savedSel=!1)}},selectionRemoveMarkers:function(){this.opts.rangy?rangy.removeMarkers(this.savedSel):(this.$editor.find("span#selection-marker-1").remove(),this.$editor.find("span#selection-marker-2").remove())},getCurrent:function(){var e=!1,t=this.getSelection();return t.rangeCount>0&&(e=t.getRangeAt(0).startContainer),this.isParentRedactor(e)},getParent:function(t){return t=t||this.getCurrent(),t?this.isParentRedactor(e(t).parent()[0]):!1},getBlock:function(t){for("undefined"==typeof t&&(t=this.getCurrent());t;){if(this.nodeTestBlocks(t))return e(t).hasClass("redactor_editor")?!1:t;t=t.parentNode}return!1},getBlocks:function(t){var i=[];if("undefined"==typeof t){var n=this.getRange();if(n&&n.collapsed===!0)return[this.getBlock()];var t=this.getNodes(n)}return e.each(t,e.proxy(function(t,n){return this.opts.iframe===!1&&0==e(n).parents("div.redactor_editor").size()?!1:(this.nodeTestBlocks(n)&&i.push(n),void 0)},this)),0===i.length&&(i=[this.getBlock()]),i},nodeTestBlocks:function(e){return 1==e.nodeType&&this.rTestBlock.test(e.nodeName)},tagTestBlock:function(e){return this.rTestBlock.test(e)},getSelectedNodes:function(e){if("undefined"==typeof e||0==e)var e=this.getRange();if(e&&e.collapsed===!0)return[this.getCurrent()];var t=this.getSelection();try{var i=t.getRangeAt(0).cloneContents()}catch(n){return!1}var s=this.document.createElement("span");s.appendChild(i),window.selnodes=s.childNodes;for(var a=selnodes.length,o=[],r=0,l=a;l>r;r++)o.push(selnodes[r]);return 0==o.length&&o.push(this.getCurrent()),o},getNodes:function(t,i){if(this.opts.linebreaks)return this.getSelectedNodes(t);if("undefined"==typeof t||0==t)var t=this.getRange();if(t&&t.collapsed===!0){if("undefined"==typeof i&&this.tagTestBlock(i)){var n=this.getBlock();
return n.tagName==i?[n]:[]}return[this.getCurrent()]}var s=[],a=[],o=this.document.getSelection();if(o.isCollapsed||(s=this.getRangeSelectedNodes(o.getRangeAt(0))),e.each(s,e.proxy(function(t,n){return this.opts.iframe===!1&&0==e(n).parents("div.redactor_editor").size()?!1:("undefined"==typeof i?""!=e.trim(n.textContent)&&a.push(n):n.tagName==i&&a.push(n),void 0)},this)),0==a.length){if("undefined"==typeof i&&this.tagTestBlock(i)){var n=this.getBlock();return n.tagName==i?a.push(n):[]}a.push(this.getCurrent())}return a},getElement:function(t){for(t||(t=this.getCurrent());t;){if(1==t.nodeType)return e(t).hasClass("redactor_editor")?!1:t;t=t.parentNode}return!1},getRangeSelectedNodes:function(e){e=e||this.getRange();var t=e.startContainer,i=e.endContainer;if(t==i)return[t];for(var n=[];t&&t!=i;)n.push(t=this.nextNode(t));for(t=e.startContainer;t&&t!=e.commonAncestorContainer;)n.unshift(t),t=t.parentNode;return n},nextNode:function(e){if(e.hasChildNodes())return e.firstChild;for(;e&&!e.nextSibling;)e=e.parentNode;return e?e.nextSibling:null},getSelectionText:function(){return this.getSelection().toString()},getSelectionHtml:function(){var e="",t=this.getSelection();if(t.rangeCount){for(var i=this.document.createElement("div"),n=t.rangeCount,s=0;n>s;++s)i.appendChild(t.getRangeAt(s).cloneContents());e=i.innerHTML}return this.syncClean(e)},tableShow:function(){this.selectionSave(),this.modalInit(this.opts.curLang.table,this.opts.modal_table,300,e.proxy(function(){e("#redactor_insert_table_btn").click(e.proxy(this.tableInsert,this)),setTimeout(function(){e("#redactor_table_rows").focus()},200)},this))},tableInsert:function(){var t,i,n,s,a=e("#redactor_table_rows").val(),o=e("#redactor_table_columns").val(),r=e("<div></div>"),l=Math.floor(99999*Math.random()),c=e('<table id="table'+l+'"><tbody></tbody></table>');for(t=0;a>t;t++){for(i=e("<tr></tr>"),n=0;o>n;n++)s=e("<td>"+this.opts.invisibleSpace+"</td>"),0===t&&0===n&&s.append('<span id="selection-marker-1">'+this.opts.invisibleSpace+"</span>"),e(i).append(s);c.append(i)}r.append(c);var d=r.html();this.modalClose(),this.selectionRestore();var h=this.getBlock()||this.getCurrent();h?e(h).after(d):this.insertHtmlAdvanced(d),this.selectionRestore();var u=this.$editor.find("#table"+l);this.tableObserver(u),this.buttonActiveObserver(),u.removeAttr("id"),this.sync()},tableObserver:function(t){this.$table=e(t.target||t).closest("table"),this.$tbody=e(t.target).closest("tbody"),this.$thead=this.$table.find("thead"),this.$current_td=e(t.target||this.$table.find("td").first()),this.$current_tr=e(t.target||this.$table.find("tr").first()).closest("tr")},tableDeleteTable:function(){this.bufferSet(),this.$table&&(this.$table.remove(),this.$table=!1,this.sync())},tableDeleteRow:function(){if(this.bufferSet(),this.$current_tr){var e=this.$current_tr.prev().length?this.$current_tr.prev():this.$current_tr.next();if(e.length){var t=e.children("td").first();t.length&&(t.prepend('<span id="selection-marker-1">'+this.opts.invisibleSpace+"</span>"),this.selectionRestore())}this.$current_tr.remove(),this.sync()}},tableDeleteColumn:function(){this.bufferSet();var t=this.$current_td.get(0).cellIndex;this.$table.find("tr").each(e.proxy(function(i,n){var s=0>t-1?t+1:t-1;0===i&&(e(n).find("td").eq(s).prepend('<span id="selection-marker-1">'+this.opts.invisibleSpace+"</span>"),this.selectionRestore()),e(n).find("td").eq(t).remove()},this)),this.sync()},tableAddHead:function(){if(this.bufferSet(),0!==this.$table.find("thead").size())this.tableDeleteHead();else{var t=this.$table.find("tr").first().clone();t.find("td").html(this.opts.invisibleSpace),this.$thead=e("<thead></thead>"),this.$thead.append(t),this.$table.prepend(this.$thead),this.sync()}},tableDeleteHead:function(){this.bufferSet(),e(this.$thead).remove(),this.$thead=!1,this.sync()},tableAddRowAbove:function(){this.tableAddRow("before")},tableAddRowBelow:function(){this.tableAddRow("after")},tableAddColumnLeft:function(){this.tableAddColumn("before")},tableAddColumnRight:function(){this.tableAddColumn("after")},tableAddRow:function(e){this.bufferSet();var t=this.$current_tr.clone();t.find("td").html(this.opts.invisibleSpace),"after"===e?this.$current_tr.after(t):this.$current_tr.before(t),this.sync()},tableAddColumn:function(t){this.bufferSet();var i=0;this.$current_tr.find("td").each(e.proxy(function(t,n){e(n)[0]===this.$current_td[0]&&(i=t)},this)),this.$table.find("tr").each(e.proxy(function(n,s){var a=e(s).find("td").eq(i),o=a.clone();o.html(this.opts.invisibleSpace),"after"===t?a.after(o):a.before(o)},this)),this.sync()},videoShow:function(){this.selectionSave(),this.modalInit(this.opts.curLang.video,this.opts.modal_video,600,e.proxy(function(){e("#redactor_insert_video_btn").click(e.proxy(this.videoInsert,this)),setTimeout(function(){e("#redactor_insert_video_area").focus()},200)},this))},videoInsert:function(){var t=e("#redactor_insert_video_area").val();t=this.cleanStripTags(t),this.selectionRestore();var i=this.getBlock()||this.getCurrent();i?(e(i).after(t),this.sync()):this.insertHtmlAdvanced(t),this.modalClose()},linkShow:function(){this.selectionSave();var t=e.proxy(function(){this.insert_link_node=!1;var t=this.getSelection(),i="",n="",s="",a=this.getParent(),o=e(a).parent().get(0);o&&"A"===o.tagName&&(a=o),a&&"A"===a.tagName?(i=a.href,n=e(a).text(),s=a.target,this.insert_link_node=a):n=t.toString(),e(".redactor_link_text").val(n);var r=self.location.href.replace(/\/$/i,""),l=i.replace(r,""),c=e("#redactor_tabs").find("a");this.opts.linkEmail===!1&&c.eq(1).remove(),this.opts.linkAnchor===!1&&c.eq(2).remove(),this.opts.linkEmail===!1&&this.opts.linkAnchor===!1?(e("#redactor_tabs").remove(),e("#redactor_link_url").val(l)):0===i.search("mailto:")?(this.modalSetTab.call(this,2),e("#redactor_tab_selected").val(2),e("#redactor_link_mailto").val(i.replace("mailto:",""))):0===l.search(/^#/gi)?(this.modalSetTab.call(this,3),e("#redactor_tab_selected").val(3),e("#redactor_link_anchor").val(l.replace(/^#/gi,""))):e("#redactor_link_url").val(l),"_blank"===s&&e("#redactor_link_blank").prop("checked",!0),e("#redactor_insert_link_btn").click(e.proxy(this.linkProcess,this)),setTimeout(function(){e("#redactor_link_url").focus()},200)},this);this.modalInit(this.opts.curLang.link,this.opts.modal_link,460,t)},linkProcess:function(){var t=e("#redactor_tab_selected").val(),i="",n="",s="",a="";if("1"===t){i=e("#redactor_link_url").val(),n=e("#redactor_link_url_text").val(),e("#redactor_link_blank").prop("checked")&&(s=' target="_blank"',a="_blank");var o="((xn--)?[a-z0-9]+(-[a-z0-9]+)*.)+[a-z]{2,}",r=new RegExp("^(http|ftp|https)://"+o,"i"),l=new RegExp("^"+o,"i");-1==i.search(r)&&0==i.search(l)&&this.opts.linkProtocol&&(i=this.opts.linkProtocol+i)}else"2"===t?(i="mailto:"+e("#redactor_link_mailto").val(),n=e("#redactor_link_mailto_text").val()):"3"===t&&(i="#"+e("#redactor_link_anchor").val(),n=e("#redactor_link_anchor_text").val());this.linkInsert('<a href="'+i+'"'+s+">"+n+"</a>",e.trim(n),i,a)},linkInsert:function(t,i,n,s){this.selectionRestore(),""!==i&&(this.insert_link_node?(this.bufferSet(),e(this.insert_link_node).text(i).attr("href",n),""!==s?e(this.insert_link_node).attr("target",s):e(this.insert_link_node).removeAttr("target"),this.sync()):this.exec("inserthtml",t)),this.modalClose()},fileShow:function(){this.selectionSave();var t=e.proxy(function(){var t=this.getSelection(),i="";i=this.oldIE()?t.text:t.toString(),e("#redactor_filename").val(i),this.isMobile()||this.draguploadInit("#redactor_file",{url:this.opts.fileUpload,uploadFields:this.opts.uploadFields,success:e.proxy(this.fileCallback,this),error:e.proxy(function(e,t){this.callback("fileUploadError",t)},this)}),this.uploadInit("redactor_file",{auto:!0,url:this.opts.fileUpload,success:e.proxy(this.fileCallback,this),error:e.proxy(function(e,t){this.callback("fileUploadError",t)},this)})},this);this.modalInit(this.opts.curLang.file,this.opts.modal_file,500,t)},fileCallback:function(t){if(this.selectionRestore(),t!==!1){var i=e("#redactor_filename").val();""===i&&(i=t.filename);var n='<a href="'+t.filelink+'" id="filelink-marker">'+i+"</a>";this.browser("webkit")&&this.window.chrome&&(n+="&nbsp;"),this.execCommand("inserthtml",n,!1);var s=e(this.$editor.find("a#filelink-marker"));0!=s.size()?s.removeAttr("id"):s=!1,this.sync(),this.callback("fileUpload",s,t)}this.modalClose()},imageShow:function(){this.selectionSave();var t=e.proxy(function(){if(this.opts.imageGetJson?e.getJSON(this.opts.imageGetJson,e.proxy(function(t){var i={},n=0;e.each(t,e.proxy(function(e,t){"undefined"!=typeof t.folder&&(n++,i[t.folder]=n)},this));var s=!1;if(e.each(t,e.proxy(function(t,n){var a="";"undefined"!=typeof n.title&&(a=n.title);var o=0;e.isEmptyObject(i)||"undefined"==typeof n.folder||(o=i[n.folder],s===!1&&(s=".redactorfolder"+o));var r=e('<img src="'+n.thumb+'" class="redactorfolder redactorfolder'+o+'" rel="'+n.image+'" title="'+a+'" />');e("#redactor_image_box").append(r),e(r).click(e.proxy(this.imageThumbClick,this))},this)),!e.isEmptyObject(i)){e(".redactorfolder").hide(),e(s).show();var a=function(t){e(".redactorfolder").hide(),e(".redactorfolder"+e(t.target).val()).show()},o=e('<select id="redactor_image_box_select">');e.each(i,function(t,i){o.append(e('<option value="'+i+'">'+t+"</option>"))}),e("#redactor_image_box").before(o),o.change(a)}},this)):e("#redactor_tabs").find("a").eq(1).remove(),this.opts.imageUpload||this.opts.s3)this.isMobile()||this.opts.s3!==!1||e("#redactor_file").length&&this.draguploadInit("#redactor_file",{url:this.opts.imageUpload,uploadFields:this.opts.uploadFields,success:e.proxy(this.imageCallback,this),error:e.proxy(function(e,t){this.callback("imageUploadError",t)},this)}),this.opts.s3===!1?this.uploadInit("redactor_file",{auto:!0,url:this.opts.imageUpload,success:e.proxy(this.imageCallback,this),error:e.proxy(function(e,t){this.callback("imageUploadError",t)},this)}):e("#redactor_file").on("change.redactor",e.proxy(this.s3handleFileSelect,this));else if(e(".redactor_tab").hide(),this.opts.imageGetJson){var t=e("#redactor_tabs").find("a");t.eq(0).remove(),t.eq(1).addClass("redactor_tabs_act"),e("#redactor_tab2").show()}else e("#redactor_tabs").remove(),e("#redactor_tab3").show();e("#redactor_upload_btn").click(e.proxy(this.imageCallbackLink,this)),this.opts.imageUpload||this.opts.imageGetJson||setTimeout(function(){e("#redactor_file_link").focus()},200)},this);this.modalInit(this.opts.curLang.image,this.opts.modal_image,610,t)},imageEdit:function(t){var i=e(t.target),n=i.parent(),s=e.proxy(function(){e("#redactor_file_alt").val(i.attr("alt")),e("#redactor_image_edit_src").attr("href",i.attr("src")),e("#redactor_form_image_align").val(i.css("float")),"A"===e(n).get(0).tagName&&e("#redactor_file_link").val(e(n).attr("href")),e("#redactor_image_delete_btn").click(e.proxy(function(){this.imageRemove(i)},this)),e("#redactorSaveBtn").click(e.proxy(function(){this.imageSave(i)},this))},this);this.modalInit(this.opts.curLang.image,this.opts.modal_image_edit,380,s)},imageRemove:function(t){var i=e(t).parent();e(t).remove(),i.length&&"P"===i[0].tagName&&(this.$editor.focus(),this.selectionStart(i)),this.callback("imageDelete",t),this.modalClose(),this.sync()},imageSave:function(t){var i=e(t).parent();e(t).attr("alt",e("#redactor_file_alt").val());var n=e("#redactor_form_image_align").val();"left"===n?e(t).css({"float":"left",margin:"0 10px 10px 0"}):"right"===n?e(t).css({"float":"right",margin:"0 0 10px 10px"}):e(t).css({"float":"none",margin:"0"});var s=e.trim(e("#redactor_file_link").val());""!==s?"A"!==e(i).get(0).tagName?e(t).replaceWith('<a href="'+s+'">'+this.outerHtml(t)+"</a>"):e(i).attr("href",s):"A"===e(i).get(0).tagName&&e(i).replaceWith(this.outerHtml(t)),this.modalClose(),this.observeImages(),this.sync()},imageResize:function(t){var i,n,s=e(t),a=!1,o=!1,r=s.width()/s.height(),l=10;s.off("hover mousedown mouseup click mousemove"),s.hover(function(){s.css("cursor","nw-resize")},function(){s.css("cursor",""),a=!1}),s.mousedown(function(e){e.preventDefault(),r=s.width()/s.height(),a=!0,o=!0,i=Math.round(e.pageX-s.eq(0).offset().left),n=Math.round(e.pageY-s.eq(0).offset().top)}),s.mouseup(e.proxy(function(){a=!1,s.css("cursor",""),this.sync()},this)),s.click(e.proxy(function(e){o&&this.imageEdit(e)},this)),s.mousemove(function(t){if(a){o=!1,Math.round(t.pageX-e(this).eq(0).offset().left)-i;var c=Math.round(t.pageY-e(this).eq(0).offset().top)-n,d=s.height(),h=parseInt(d,10)+c,u=Math.round(h*r);u>l&&s.width(u),i=Math.round(t.pageX-e(this).eq(0).offset().left),n=Math.round(t.pageY-e(this).eq(0).offset().top)}})},imageThumbClick:function(t){var i='<img id="image-marker" src="'+e(t.target).attr("rel")+'" alt="'+e(t.target).attr("title")+'" />';this.opts.paragraphy&&(i="<p>"+i+"</p>"),this.imageInsert(i,!0)},imageCallbackLink:function(){var t=e("#redactor_file_link").val();if(""!==t){var i='<img id="image-marker" src="'+t+'" />';this.opts.linebreaks===!1&&(i="<p>"+i+"</p>"),this.imageInsert(i,!0)}else this.modalClose()},imageCallback:function(e){this.imageInsert(e)},imageInsert:function(t,i){if(this.selectionRestore(),t!==!1){var n="";i!==!0?(n='<img id="image-marker" src="'+t.filelink+'" />',this.opts.paragraphy&&(n="<p>"+n+"</p>")):n=t,this.execCommand("inserthtml",n,!1);var s=e(this.$editor.find("img#image-marker"));s.length?s.removeAttr("id"):s=!1,this.sync(),i!==!0&&this.callback("imageUpload",s,t)}this.modalClose(),this.observeImages()},modalTemplatesInit:function(){e.extend(this.opts,{modal_file:String()+'<section><div id="redactor-progress" class="redactor-progress redactor-progress-striped" style="display: none;"><div id="redactor-progress-bar" class="redactor-progress-bar" style="width: 100%;"></div></div><form id="redactorUploadFileForm" method="post" action="" enctype="multipart/form-data"><label>'+this.opts.curLang.filename+'</label><input type="text" id="redactor_filename" class="redactor_input" /><div style="margin-top: 7px;"><input type="file" id="redactor_file" name="file" /></div></form></section>',modal_image_edit:String()+"<section><label>"+this.opts.curLang.title+'</label><input id="redactor_file_alt" class="redactor_input" /><label>'+this.opts.curLang.link+'</label><input id="redactor_file_link" class="redactor_input" /><label>'+this.opts.curLang.image_position+'</label><select id="redactor_form_image_align"><option value="none">'+this.opts.curLang.none+'</option><option value="left">'+this.opts.curLang.left+'</option><option value="right">'+this.opts.curLang.right+'</option></select></section><footer><a href="#" id="redactor_image_delete_btn" class="redactor_modal_btn">'+this.opts.curLang._delete+'</a>&nbsp;&nbsp;&nbsp;<a href="#" class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+'</a><input type="button" name="save" class="redactor_modal_btn" id="redactorSaveBtn" value="'+this.opts.curLang.save+'" /></footer>',modal_image:String()+'<section><div id="redactor_tabs"><a href="#" class="redactor_tabs_act">'+this.opts.curLang.upload+'</a><a href="#">'+this.opts.curLang.choose+'</a><a href="#">'+this.opts.curLang.link+'</a></div><div id="redactor-progress" class="redactor-progress redactor-progress-striped" style="display: none;"><div id="redactor-progress-bar" class="redactor-progress-bar" style="width: 100%;"></div></div><form id="redactorInsertImageForm" method="post" action="" enctype="multipart/form-data"><div id="redactor_tab1" class="redactor_tab"><input type="file" id="redactor_file" name="file" /></div><div id="redactor_tab2" class="redactor_tab" style="display: none;"><div id="redactor_image_box"></div></div></form><div id="redactor_tab3" class="redactor_tab" style="display: none;"><label>'+this.opts.curLang.image_web_link+'</label><input type="text" name="redactor_file_link" id="redactor_file_link" class="redactor_input"  /></div></section><footer><a href="#" class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+'</a><input type="button" name="upload" class="redactor_modal_btn" id="redactor_upload_btn" value="'+this.opts.curLang.insert+'" /></footer>',modal_link:String()+'<section><form id="redactorInsertLinkForm" method="post" action=""><div id="redactor_tabs"><a href="#" class="redactor_tabs_act">URL</a><a href="#">Email</a><a href="#">'+this.opts.curLang.anchor+'</a></div><input type="hidden" id="redactor_tab_selected" value="1" /><div class="redactor_tab" id="redactor_tab1"><label>URL</label><input type="text" id="redactor_link_url" class="redactor_input"  /><label>'+this.opts.curLang.text+'</label><input type="text" class="redactor_input redactor_link_text" id="redactor_link_url_text" /><label><input type="checkbox" id="redactor_link_blank"> '+this.opts.curLang.link_new_tab+'</label></div><div class="redactor_tab" id="redactor_tab2" style="display: none;"><label>Email</label><input type="text" id="redactor_link_mailto" class="redactor_input" /><label>'+this.opts.curLang.text+'</label><input type="text" class="redactor_input redactor_link_text" id="redactor_link_mailto_text" /></div><div class="redactor_tab" id="redactor_tab3" style="display: none;"><label>'+this.opts.curLang.anchor+'</label><input type="text" class="redactor_input" id="redactor_link_anchor"  /><label>'+this.opts.curLang.text+'</label><input type="text" class="redactor_input redactor_link_text" id="redactor_link_anchor_text" /></div></form></section><footer><a href="#" class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+'</a><input type="button" class="redactor_modal_btn" id="redactor_insert_link_btn" value="'+this.opts.curLang.insert+'" /></footer>',modal_table:String()+"<section><label>"+this.opts.curLang.rows+'</label><input type="text" size="5" value="2" id="redactor_table_rows" /><label>'+this.opts.curLang.columns+'</label><input type="text" size="5" value="3" id="redactor_table_columns" /></section><footer><a href="#" class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+'</a><input type="button" name="upload" class="redactor_modal_btn" id="redactor_insert_table_btn" value="'+this.opts.curLang.insert+'" /></footer>',modal_video:String()+'<section><form id="redactorInsertVideoForm"><label>'+this.opts.curLang.video_html_code+'</label><textarea id="redactor_insert_video_area" style="width: 99%; height: 160px;"></textarea></form></section><footer><a href="javascript:void(null);" class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+'</a><input type="button" class="redactor_modal_btn" id="redactor_insert_video_btn" value="'+this.opts.curLang.insert+'" /></footer>'})},modalInit:function(t,i,n,s){var a=e("#redactor_modal_overlay");a.length||(this.$overlay=a=e('<div id="redactor_modal_overlay" style="display: none;"></div>'),e("body").prepend(this.$overlay)),this.opts.modalOverlay&&a.show().on("click",e.proxy(this.modalClose,this));var o=e("#redactor_modal");o.length||(this.$modal=o=e('<div id="redactor_modal" style="display: none;"><div id="redactor_modal_close">&times;</div><header id="redactor_modal_header"></header><div id="redactor_modal_inner"></div></div>'),e("body").append(this.$modal)),e("#redactor_modal_close").on("click",e.proxy(this.modalClose,this)),this.hdlModalClose=e.proxy(function(e){return e.keyCode===this.keyCode.ESC?(this.modalClose(),!1):void 0},this),e(document).keyup(this.hdlModalClose),this.$editor.keyup(this.hdlModalClose),this.modalcontent=!1,0==i.indexOf("#")?(this.modalcontent=e(i),e("#redactor_modal_inner").empty().append(this.modalcontent.html()),this.modalcontent.html("")):e("#redactor_modal_inner").empty().append(i),o.find("#redactor_modal_header").html(t),"undefined"!=typeof e.fn.draggable&&(o.draggable({handle:"#redactor_modal_header"}),o.find("#redactor_modal_header").css("cursor","move"));var r=e("#redactor_tabs");if(r.length){var l=this;r.find("a").each(function(t,i){t++,e(i).on("click",function(i){if(i.preventDefault(),r.find("a").removeClass("redactor_tabs_act"),e(this).addClass("redactor_tabs_act"),e(".redactor_tab").hide(),e("#redactor_tab"+t).show(),e("#redactor_tab_selected").val(t),l.isMobile()===!1){var n=o.outerHeight();o.css("margin-top","-"+(n+10)/2+"px")}})})}o.find(".redactor_btn_modal_close").on("click",e.proxy(this.modalClose,this)),this.isMobile()===!1?(o.css({position:"fixed",top:"-2000px",left:"50%",width:n+"px",marginLeft:"-"+(n+60)/2+"px"}).show(),this.modalSaveBodyOveflow=e(document.body).css("overflow"),e(document.body).css("overflow","hidden")):o.css({position:"fixed",width:"100%",height:"100%",top:"0",left:"0",margin:"0",minHeight:"300px"}).show(),"function"==typeof s&&s(),this.isMobile()===!1&&setTimeout(function(){var e=o.outerHeight();o.css({top:"50%",height:"auto",minHeight:"auto",marginTop:"-"+(e+10)/2+"px"})},20)},modalClose:function(){return e("#redactor_modal_close").off("click",this.modalClose),e("#redactor_modal").fadeOut("fast",e.proxy(function(){var t=e("#redactor_modal_inner");this.modalcontent!==!1&&(this.modalcontent.html(t.html()),this.modalcontent=!1),t.html(""),this.opts.modalOverlay&&e("#redactor_modal_overlay").hide().off("click",this.modalClose),e(document).unbind("keyup",this.hdlModalClose),this.$editor.unbind("keyup",this.hdlModalClose),this.selectionRestore()},this)),this.isMobile()===!1&&e(document.body).css("overflow",this.modalSaveBodyOveflow?this.modalSaveBodyOveflow:"visible"),!1},modalSetTab:function(t){e(".redactor_tab").hide(),e("#redactor_tabs").find("a").removeClass("redactor_tabs_act").eq(t-1).addClass("redactor_tabs_act"),e("#redactor_tab"+t).show()},s3handleFileSelect:function(e){for(var t,i=e.target.files,n=0;t=i[n];n++)this.s3uploadFile(t)},s3uploadFile:function(t){this.s3executeOnSignedUrl(t,e.proxy(function(e){this.s3uploadToS3(t,e)},this))},s3executeOnSignedUrl:function(t,i){var n=new XMLHttpRequest;n.open("GET",this.opts.s3+"?name="+t.name+"&type="+t.type,!0),n.overrideMimeType("text/plain; charset=x-user-defined"),n.onreadystatechange=function(){4==this.readyState&&200==this.status?(e("#redactor-progress").fadeIn(),i(decodeURIComponent(this.responseText))):4==this.readyState&&200!=this.status},n.send()},s3createCORSRequest:function(e,t){var i=new XMLHttpRequest;return"withCredentials"in i?i.open(e,t,!0):"undefined"!=typeof XDomainRequest?(i=new XDomainRequest,i.open(e,t)):i=null,i},s3uploadToS3:function(t,i){var n=this.s3createCORSRequest("PUT",i);n&&(n.onload=e.proxy(function(){if(200==n.status){e("#redactor-progress").hide();var t=i.split("?");if(!t[0])return!1;this.selectionRestore();var s="";s='<img id="image-marker" src="'+t[0]+'" />',this.opts.paragraphy&&(s="<p>"+s+"</p>"),this.execCommand("inserthtml",s,!1);var a=e(this.$editor.find("img#image-marker"));a.length?a.removeAttr("id"):a=!1,this.sync(),this.callback("imageUpload",a,!1),this.modalClose(),this.observeImages()}},this),n.onerror=function(){},n.upload.onprogress=function(){},n.setRequestHeader("Content-Type",t.type),n.setRequestHeader("x-amz-acl","public-read"),n.send(t))},uploadInit:function(t,i){this.uploadOptions={url:!1,success:!1,error:!1,start:!1,trigger:!1,auto:!1,input:!1},e.extend(this.uploadOptions,i);var n=e("#"+t);n.length&&"INPUT"===n[0].tagName?(this.uploadOptions.input=n,this.el=e(n[0].form)):this.el=n,this.element_action=this.el.attr("action"),this.uploadOptions.auto?e(this.uploadOptions.input).change(e.proxy(function(e){this.el.submit(function(){return!1}),this.uploadSubmit(e)},this)):this.uploadOptions.trigger&&e("#"+this.uploadOptions.trigger).click(e.proxy(this.uploadSubmit,this))},uploadSubmit:function(){e("#redactor-progress").fadeIn(),this.uploadForm(this.element,this.uploadFrame())},uploadFrame:function(){this.id="f"+Math.floor(99999*Math.random());var t=this.document.createElement("div"),i='<iframe style="display:none" id="'+this.id+'" name="'+this.id+'"></iframe>';return t.innerHTML=i,e(t).appendTo("body"),this.uploadOptions.start&&this.uploadOptions.start(),e("#"+this.id).load(e.proxy(this.uploadLoaded,this)),this.id},uploadForm:function(t,i){if(this.uploadOptions.input){var n="redactorUploadForm"+this.id,s="redactorUploadFile"+this.id;this.form=e('<form  action="'+this.uploadOptions.url+'" method="POST" target="'+i+'" name="'+n+'" id="'+n+'" enctype="multipart/form-data" />'),this.opts.uploadFields!==!1&&"object"==typeof this.opts.uploadFields&&e.each(this.opts.uploadFields,e.proxy(function(t,i){0===i.toString().indexOf("#")&&(i=e(i).val());var n=e("<input/>",{type:"hidden",name:t,value:i});e(this.form).append(n)},this));var a=this.uploadOptions.input,o=e(a).clone();e(a).attr("id",s).before(o).appendTo(this.form),e(this.form).css("position","absolute").css("top","-2000px").css("left","-2000px").appendTo("body"),this.form.submit()}else t.attr("target",i).attr("method","POST").attr("enctype","multipart/form-data").attr("action",this.uploadOptions.url),this.element.submit()},uploadLoaded:function(){var t,i=e("#"+this.id)[0];if(t=i.contentDocument?i.contentDocument:i.contentWindow?i.contentWindow.document:window.frames[this.id].document,this.uploadOptions.success)if(e("#redactor-progress").hide(),"undefined"!=typeof t){var n=t.body.innerHTML,s=n.match(/\{(.|\n)*\}/)[0];s=s.replace(/^\[/,""),s=s.replace(/\]$/,"");var a=e.parseJSON(s);"undefined"==typeof a.error?this.uploadOptions.success(a):(this.uploadOptions.error(this,a),this.modalClose())}else this.modalClose(),alert("Upload failed!");this.el.attr("action",this.element_action),this.el.attr("target","")},draguploadInit:function(t,i){return this.draguploadOptions=e.extend({url:!1,success:!1,error:!1,preview:!1,uploadFields:!1,text:this.opts.curLang.drop_file_here,atext:this.opts.curLang.or_choose},i),void 0===window.FormData?!1:(this.droparea=e('<div class="redactor_droparea"></div>'),this.dropareabox=e('<div class="redactor_dropareabox">'+this.draguploadOptions.text+"</div>"),this.dropalternative=e('<div class="redactor_dropalternative">'+this.draguploadOptions.atext+"</div>"),this.droparea.append(this.dropareabox),e(t).before(this.droparea),e(t).before(this.dropalternative),this.dropareabox.on("dragover",e.proxy(function(){return this.draguploadOndrag()},this)),this.dropareabox.on("dragleave",e.proxy(function(){return this.draguploadOndragleave()},this)),this.dropareabox.get(0).ondrop=e.proxy(function(e){e.preventDefault(),this.dropareabox.removeClass("hover").addClass("drop"),this.draguploadUpload(e.dataTransfer.files[0])},this),void 0)},draguploadUpload:function(t){var i=jQuery.ajaxSettings.xhr();i.upload&&i.upload.addEventListener("progress",e.proxy(this.uploadProgress,this),!1);var n=function(){return i},s=new FormData;this.draguploadOptions.uploadFields!==!1&&"object"==typeof this.draguploadOptions.uploadFields&&e.each(this.draguploadOptions.uploadFields,e.proxy(function(t,i){0===i.toString().indexOf("#")&&(i=e(i).val()),s.append(t,i)},this)),s.append("file",t),e.ajax({url:this.draguploadOptions.url,dataType:"html",data:s,xhr:n,cache:!1,contentType:!1,processData:!1,type:"POST",success:e.proxy(function(t){t=t.replace(/^\[/,""),t=t.replace(/\]$/,"");var i=e.parseJSON(t);"undefined"==typeof i.error?this.draguploadOptions.success(i):(this.draguploadOptions.error(this,i),this.draguploadOptions.success(!1))},this)})},draguploadOndrag:function(){return this.dropareabox.addClass("hover"),!1},draguploadOndragleave:function(){return this.dropareabox.removeClass("hover"),!1},uploadProgress:function(e,t){var i=e.loaded?parseInt(100*(e.loaded/e.total),10):e;this.dropareabox.text("Loading "+i+"% "+(t||""))},isMobile:function(){return/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)},outerHtml:function(t){return e("<div>").append(e(t).eq(0).clone()).html()},isString:function(e){return"[object String]"==Object.prototype.toString.call(e)},isEmpty:function(e){return e=e.replace(/&#x200b;|<br>|<br\/>|&nbsp;/gi,""),e=e.replace(/\s/g,""),e=e.replace(/^<p>[^\w\d]*?<\/p>$/i,""),""==e},browser:function(e){var t=navigator.userAgent.toLowerCase(),i=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return"version"==e?i[2]:"webkit"==e?"chrome"==i[1]||"webkit"==i[1]:i[1]==e},oldIE:function(){return this.browser("msie")&&parseInt(this.browser("version"),10)<9?!0:!1},getFragmentHtml:function(e){var t=e.cloneNode(!0),i=this.document.createElement("div");return i.appendChild(t),i.innerHTML},extractContent:function(){for(var e,t=this.$editor[0],i=this.document.createDocumentFragment();e=t.firstChild;)i.appendChild(e);return i},isParentRedactor:function(t){return t?this.opts.iframe?t:0==e(t).parents("div.redactor_editor").length||e(t).hasClass("redactor_editor")?!1:t:!1},currentOrParentIs:function(e){var t=this.getParent(),i=this.getCurrent();return t&&t.tagName===e?t:i&&i.tagName===e?i:!1},isEndOfElement:function(){var t=this.getBlock(),i=this.getCaretOffset(t),n=e.trim(e(t).text()).replace(/\n\r\n/g,""),s=n.length;return i==s?!0:!1},isFocused:function(){var t,i=this.getSelection();return i.rangeCount&&i.rangeCount>0&&(t=i.getRangeAt(0).startContainer),t?this.opts.iframe?this.getCaretOffsetRange().equals()?!this.$editor.is(t):!0:0!=e(t).closest("div.redactor_editor").length:!1},removeEmptyAttr:function(t,i){""==e(t).attr(i)&&e(t).removeAttr(i)},removeFromArrayByValue:function(e,t){for(var i=null;-1!==(i=e.indexOf(t));)e.splice(i,1);return e}},t.prototype.init.prototype=t.prototype,e.Redactor.fn.formatLinkify=function(t){for(var i=/(^|&lt;|\s)(www\..+?\..+?)(\s|&gt;|$)/g,n=/(^|&lt;|\s)(((https?|ftp):\/\/|mailto:).+?)(\s|&gt;|$)/g,s=(this.$editor?this.$editor.get(0):this).childNodes,a=s.length;a--;){var o=s[a];if(3===o.nodeType){var r=o.nodeValue;r&&(r.match(i)||r.match(n))&&(r=r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(i,'$1<a href="'+t+'$2">$2</a>$3').replace(n,'$1<a href="$2">$2</a>$5'),e(o).after(r).remove())}else 1!==o.nodeType||/^(a|button|textarea)$/i.test(o.tagName)||e.Redactor.fn.formatLinkify.call(o,t)}}}(jQuery);